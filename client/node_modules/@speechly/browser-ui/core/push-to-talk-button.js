!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";function t(){}const g=t=>t;function e(t){return t()}function I(){return Object.create(null)}function C(t){t.forEach(e)}function i(t){return"function"==typeof t}function o(t,g){return t!=t?g==g:t!==g||t&&"object"==typeof t||"function"==typeof t}function n(t,g){return t!=t?g==g:t!==g}function s(t){return 0===Object.keys(t).length}const A="undefined"!=typeof window;let c=A?()=>window.performance.now():()=>Date.now(),a=A?t=>requestAnimationFrame(t):t;const l=new Set;function d(t){l.forEach((g=>{g.c(t)||(l.delete(g),g.f())})),0!==l.size&&a(d)}function r(t){let g;return 0===l.size&&a(d),{promise:new Promise((e=>{l.add(g={c:t,f:e})})),abort(){l.delete(g)}}}function h(t,g){t.appendChild(g)}function u(t,g,e){const I=b(t);if(!I.getElementById(g)){const t=y("style");t.id=g,t.textContent=e,m(I,t)}}function b(t){if(!t)return document;const g=t.getRootNode?t.getRootNode():t.ownerDocument;return g&&g.host?g:t.ownerDocument}function p(t){const g=y("style");return m(b(t),g),g.sheet}function m(t,g){return h(t.head||t,g),g.sheet}function Z(t,g,e){t.insertBefore(g,e||null)}function G(t){t.parentNode&&t.parentNode.removeChild(t)}function y(t){return document.createElement(t)}function v(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function W(t){return document.createTextNode(t)}function V(){return W(" ")}function R(){return W("")}function w(t,g,e,I){return t.addEventListener(g,e,I),()=>t.removeEventListener(g,e,I)}function B(t,g,e){null==e?t.removeAttribute(g):t.getAttribute(g)!==e&&t.setAttribute(g,e)}function f(t,g,e){g in t?t[g]="boolean"==typeof t[g]&&""===e||e:B(t,g,e)}function X(t,g,e,I){null===e?t.style.removeProperty(g):t.style.setProperty(g,e,I?"important":"")}function S(t,g,e){t.classList[e?"add":"remove"](g)}function N(t){const g={};for(const e of t)g[e.name]=e.value;return g}const Y=new Map;let z,x=0;function F(t,g,e,I,C,i,o,n=0){const s=16.666/I;let A="{\n";for(let t=0;t<=1;t+=s){const I=g+(e-g)*i(t);A+=100*t+`%{${o(I,1-I)}}\n`}const c=A+`100% {${o(e,1-e)}}\n}`,a=`__svelte_${function(t){let g=5381,e=t.length;for(;e--;)g=(g<<5)-g^t.charCodeAt(e);return g>>>0}(c)}_${n}`,l=b(t),{stylesheet:d,rules:r}=Y.get(l)||function(t,g){const e={stylesheet:p(g),rules:{}};return Y.set(t,e),e}(l,t);r[a]||(r[a]=!0,d.insertRule(`@keyframes ${a} ${c}`,d.cssRules.length));const h=t.style.animation||"";return t.style.animation=`${h?`${h}, `:""}${a} ${I}ms linear ${C}ms 1 both`,x+=1,a}function k(t,g){const e=(t.style.animation||"").split(", "),I=e.filter(g?t=>t.indexOf(g)<0:t=>-1===t.indexOf("__svelte")),C=e.length-I.length;C&&(t.style.animation=I.join(", "),x-=C,x||a((()=>{x||(Y.forEach((t=>{const{ownerNode:g}=t.stylesheet;g&&G(g)})),Y.clear())})))}function H(t){z=t}function J(){if(!z)throw new Error("Function called outside component initialization");return z}function K(t){J().$$.on_mount.push(t)}const T=[],U=[],E=[],M=[],D=Promise.resolve();let $=!1;function Q(t){E.push(t)}const L=new Set;let O,j=0;function P(){if(0!==j)return;const t=z;do{try{for(;j<T.length;){const t=T[j];j++,H(t),_(t.$$)}}catch(t){throw T.length=0,j=0,t}for(H(null),T.length=0,j=0;U.length;)U.pop()();for(let t=0;t<E.length;t+=1){const g=E[t];L.has(g)||(L.add(g),g())}E.length=0}while(T.length);for(;M.length;)M.pop()();$=!1,L.clear(),H(t)}function _(t){if(null!==t.fragment){t.update(),C(t.before_update);const g=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,g),t.after_update.forEach(Q)}}function q(){return O||(O=Promise.resolve(),O.then((()=>{O=null}))),O}function tt(t,g,e){t.dispatchEvent(function(t,g,{bubbles:e=!1,cancelable:I=!1}={}){const C=document.createEvent("CustomEvent");return C.initCustomEvent(t,e,I,g),C}(`${g?"intro":"outro"}${e}`))}const gt=new Set;let et;function It(t,g){t&&t.i&&(gt.delete(t),t.i(g))}function Ct(t,g,e,I){if(t&&t.o){if(gt.has(t))return;gt.add(t),et.c.push((()=>{gt.delete(t),I&&(e&&t.d(1),I())})),t.o(g)}else I&&I()}const it={duration:0};const ot="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function nt(t){t&&t.c()}function st(t,g,I,o){const{fragment:n,after_update:s}=t.$$;n&&n.m(g,I),o||Q((()=>{const g=t.$$.on_mount.map(e).filter(i);t.$$.on_destroy?t.$$.on_destroy.push(...g):C(g),t.$$.on_mount=[]})),s.forEach(Q)}function At(t,g){const e=t.$$;null!==e.fragment&&(C(e.on_destroy),e.fragment&&e.fragment.d(g),e.on_destroy=e.fragment=null,e.ctx=[])}function ct(t,g){-1===t.$$.dirty[0]&&(T.push(t),$||($=!0,D.then(P)),t.$$.dirty.fill(0)),t.$$.dirty[g/31|0]|=1<<g%31}function at(g,e,i,o,n,s,A,c=[-1]){const a=z;H(g);const l=g.$$={fragment:null,ctx:[],props:s,update:t,not_equal:n,bound:I(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(a?a.$$.context:[])),callbacks:I(),dirty:c,skip_bound:!1,root:e.target||a.$$.root};A&&A(l.root);let d=!1;if(l.ctx=i?i(g,e.props||{},((t,e,...I)=>{const C=I.length?I[0]:e;return l.ctx&&n(l.ctx[t],l.ctx[t]=C)&&(!l.skip_bound&&l.bound[t]&&l.bound[t](C),d&&ct(g,t)),e})):[],l.update(),d=!0,C(l.before_update),l.fragment=!!o&&o(l.ctx),e.target){if(e.hydrate){const t=function(t){return Array.from(t.childNodes)}(e.target);l.fragment&&l.fragment.l(t),t.forEach(G)}else l.fragment&&l.fragment.c();e.intro&&It(g.$$.fragment),st(g,e.target,e.anchor,e.customElement),P()}H(a)}let lt;"function"==typeof HTMLElement&&(lt=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:t}=this.$$;this.$$.on_disconnect=t.map(e).filter(i);for(const t in this.$$.slotted)this.appendChild(this.$$.slotted[t])}attributeChangedCallback(t,g,e){this[t]=e}disconnectedCallback(){C(this.$$.on_disconnect)}$destroy(){At(this,1),this.$destroy=t}$on(g,e){if(!i(e))return t;const I=this.$$.callbacks[g]||(this.$$.callbacks[g]=[]);return I.push(e),()=>{const t=I.indexOf(e);-1!==t&&I.splice(t,1)}}$set(t){this.$$set&&!s(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}});class dt{$destroy(){At(this,1),this.$destroy=t}$on(g,e){if(!i(e))return t;const I=this.$$.callbacks[g]||(this.$$.callbacks[g]=[]);return I.push(e),()=>{const t=I.indexOf(e);-1!==t&&I.splice(t,1)}}$set(t){this.$$set&&!s(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function rt(t){u(t,"svelte-1mwhwtl",".Frame.svelte-1mwhwtl{position:absolute;width:100%;height:100%;top:50%;left:50%;transform-origin:50% 50%;transform:translate(-50%, -50%) rotate(var(--fx-rotation));transition:width 0.1s, height 0.1s;pointer-events:none;user-select:none}")}function ht(g){let e,I,C,i,o,n,s;return{c(){e=v("svg"),I=v("defs"),C=v("linearGradient"),i=v("stop"),o=v("stop"),n=v("circle"),s=v("circle"),B(i,"stop-color","var(--gradient-stop1)"),B(i,"offset","0%"),B(o,"stop-color","var(--gradient-stop2)"),B(o,"offset","100%"),B(C,"x1","50%"),B(C,"y1","0%"),B(C,"x2","50%"),B(C,"y2","100%"),B(C,"id","a"),B(n,"cx","46"),B(n,"cy","46"),B(n,"r",g[0]),B(n,"stroke","none"),B(n,"fill","var(--frame-background)"),B(s,"cx","46"),B(s,"cy","46"),B(s,"r",g[0]),B(s,"stroke","url(#a)"),B(s,"stroke-width","var(--frame-stroke-width)"),B(s,"fill","none"),B(e,"class","Frame svelte-1mwhwtl"),B(e,"viewBox","0 0 92 92"),B(e,"xmlns","http://www.w3.org/2000/svg")},m(t,g){Z(t,e,g),h(e,I),h(I,C),h(C,i),h(C,o),h(e,n),h(e,s)},p(t,[g]){1&g&&B(n,"r",t[0]),1&g&&B(s,"r",t[0])},i:t,o:t,d(t){t&&G(e)}}}function ut(t,g,e){let{frameRadius:I=46}=g;return t.$$set=t=>{"frameRadius"in t&&e(0,I=t.frameRadius)},[I]}class bt extends dt{constructor(t){super(),at(this,t,ut,ht,o,{frameRadius:0},rt)}}const pt=new Error("Current device does not support microphone API"),mt=new Error("AppId changed without project login");class Zt extends Error{constructor(t,g,e,...I){super(...I),this.name=`WebsocketError code ${g}`,this.message=t,this.code=g,this.wasClean=e}}const Gt=16e3;class yt{constructor(t,g){this.isFinalized=!1,this.words=[],this.entities=new Map,this.intent={intent:"",isFinal:!1},this.contextId=t,this.id=g}toSegment(){let t=0;const g=new Array(this.entities.size);return this.entities.forEach((e=>{g[t]=e,t++})),{id:this.id,contextId:this.contextId,isFinal:this.isFinalized,words:this.words,entities:g,intent:this.intent}}toString(){const t=this.toSegment(),g=t.words.filter((t=>t.value)),e=Object.assign(Object.assign({},t),{words:g});return JSON.stringify(e,null,2)}updateTranscript(t){return t.forEach((t=>{this.isFinalized&&!t.isFinal||(this.words[t.index]=t)})),this}updateEntities(t){return t.forEach((t=>{this.isFinalized&&!t.isFinal||this.entities.set(this.entityMapKey(t),t)})),this}updateIntent(t){return this.isFinalized&&!t.isFinal||(this.intent=t),this}finalize(){return this.entities.forEach(((t,g)=>{t.isFinal||this.entities.delete(g)})),this.words=this.words.filter((t=>t.isFinal)),this.intent.isFinal||(this.intent.intent="",this.intent.isFinal=!0),this.isFinalized=!0,this}entityMapKey(t){return`${t.startPosition.toString()}:${t.endPosition.toString()}`}}function vt(t,g,e,I){return new(e||(e=Promise))((function(C,i){function o(t){try{s(I.next(t))}catch(t){i(t)}}function n(t){try{s(I.throw(t))}catch(t){i(t)}}function s(t){var g;t.done?C(t.value):(g=t.value,g instanceof e?g:new e((function(t){t(g)}))).then(o,n)}s((I=I.apply(t,g||[])).next())}))}const Wt=new Error("Microphone consent is not given");var Vt,Rt,wt,Bt;!function(t){t.NoAudioConsent="NoAudioConsent",t.NoBrowserSupport="NoBrowserSupport",t.Stopped="Stopped",t.Starting="Starting",t.Started="Started"}(Vt||(Vt={}));class ft{constructor(){this.muted=!1,this.initialized=!1,this.state=Vt.Stopped,this.debug=!1,this.stateChangeCbs=[];try{const t=window.navigator.mediaDevices.getSupportedConstraints();this.nativeResamplingSupported=!0===t.sampleRate,this.autoGainControlSupported=!0===t.autoGainControl}catch(t){this.nativeResamplingSupported=!1,this.autoGainControlSupported=!1}}onStateChange(t){this.stateChangeCbs.push(t)}initialize(){var t;return vt(this,void 0,void 0,(function*(){if(this.initialized)return;if(void 0===(null===(t=window.navigator)||void 0===t?void 0:t.mediaDevices))throw this.setState(Vt.NoBrowserSupport),pt;const g={video:!1};this.nativeResamplingSupported||this.autoGainControlSupported?g.audio={sampleRate:Gt,autoGainControl:this.autoGainControlSupported}:g.audio=!0;try{this.setState(Vt.Starting),this.mediaStream=yield window.navigator.mediaDevices.getUserMedia(g)}catch(t){throw this.setState(Vt.NoAudioConsent),console.error(t),Wt}this.initialized=!0,this.muted=!0,this.setState(Vt.Started)}))}setState(t){this.state!==t&&(this.debug&&console.log("[BrowserMicrophone]",this.state,"->",t),this.state=t,this.stateChangeCbs.forEach((g=>g(t))))}close(){return vt(this,void 0,void 0,(function*(){if(!this.initialized)return;this.muted=!0;this.mediaStream.getTracks().forEach((t=>t.stop())),this.mediaStream=void 0,this.initialized=!1,this.setState(Vt.Stopped)}))}isRecording(){return!this.muted}}!function(t){t.Started="started",t.Stopped="stopped",t.SegmentEnd="segment_end",t.Transcript="transcript",t.Entity="entity",t.Intent="intent",t.TentativeTranscript="tentative_transcript",t.TentativeEntities="tentative_entities",t.TentativeIntent="tentative_intent"}(Rt||(Rt={})),function(t){t.Opened="WEBSOCKET_OPEN",t.Closed="WEBSOCKET_CLOSED",t.AudioProcessorReady="SOURCE_SAMPLE_RATE_SET_SUCCESS",t.VadSignalHigh="VadSignalHigh",t.VadSignalLow="VadSignalLow",t.RequestContextStart="RequestContextStart"}(wt||(wt={})),function(t){t.connect="connect",t.initAudioProcessor="initAudioProcessor",t.adjustAudioProcessor="adjustAudioProcessor",t.SET_SHARED_ARRAY_BUFFERS="SET_SHARED_ARRAY_BUFFERS",t.CLOSE="CLOSE",t.START_CONTEXT="START_CONTEXT",t.SWITCH_CONTEXT="SWITCH_CONTEXT",t.STOP_CONTEXT="STOP_CONTEXT",t.AUDIO="AUDIO",t.startStream="startStream",t.stopStream="stopStream",t.setContextOptions="setContextOptions"}(Bt||(Bt={}));const Xt={connect:!0,apiUrl:"https://api.speechly.com",sampleRate:Gt,debug:!1,logSegments:!1,frameMillis:30,historyFrames:5},St={enabled:!1,controlListening:!0,signalToNoiseDb:3,noiseGateDb:-24,noiseLearnHalftimeMillis:400,signalSearchFrames:5,signalActivation:.7,signalRelease:.2,signalSustainMillis:3e3},Nt={preserveSegments:!1,sampleRate:Gt,immediate:!1,autoStarted:!1};var Yt;!function(t){t[t.Failed=0]="Failed",t[t.Disconnected=1]="Disconnected",t[t.Connected=2]="Connected",t[t.Active=3]="Active"}(Yt||(Yt={}));class zt extends Array{addEventListener(t){this.push(t)}removeEventListener(t){const g=this.findIndex((g=>g===t));g>=0&&this.splice(g,1)}}class xt{constructor(){this.stateChangeCbs=new zt,this.transcriptCbs=new zt,this.entityCbs=new zt,this.intentCbs=new zt,this.segmentChangeCbs=new zt,this.tentativeTranscriptCbs=new zt,this.tentativeEntityCbs=new zt,this.tentativeIntentCbs=new zt,this.contextStartedCbs=new zt,this.contextStoppedCbs=new zt,this.onVadStateChange=new zt}}const Ft=new Error("BrowserClient already started"),kt=new Error("BrowserClient already stopped");function Ht(t){var g;return null!==(g=Jt.get(t))&&void 0!==g?g:"unknown"}const Jt=new Map([[Yt.Failed,"Failed"],[Yt.Disconnected,"Disconnected"],[Yt.Connected,"Connected"],[Yt.Active,"Active"]]);var Kt,Tt=new Uint8Array(16);function Ut(){if(!Kt&&!(Kt="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Kt(Tt)}var Et=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var Mt=[],Dt=0;Dt<256;++Dt)Mt.push((Dt+256).toString(16).substr(1));function $t(t){var g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=(Mt[t[g+0]]+Mt[t[g+1]]+Mt[t[g+2]]+Mt[t[g+3]]+"-"+Mt[t[g+4]]+Mt[t[g+5]]+"-"+Mt[t[g+6]]+Mt[t[g+7]]+"-"+Mt[t[g+8]]+Mt[t[g+9]]+"-"+Mt[t[g+10]]+Mt[t[g+11]]+Mt[t[g+12]]+Mt[t[g+13]]+Mt[t[g+14]]+Mt[t[g+15]]).toLowerCase();if(!function(t){return"string"==typeof t&&Et.test(t)}(e))throw TypeError("Stringified UUID is invalid");return e}function Qt(t,g,e){var I=(t=t||{}).random||(t.rng||Ut)();if(I[6]=15&I[6]|64,I[8]=63&I[8]|128,g){e=e||0;for(var C=0;C<16;++C)g[e+C]=I[C];return g}return $t(I)}var Lt,Ot,jt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Pt={exports:{}};
/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */
Lt=Pt,Ot=Pt.exports,function(t){var g=Ot,e=Lt&&Lt.exports==g&&Lt,I="object"==typeof jt&&jt;I.global!==I&&I.window!==I||(t=I);var C=function(t){this.message=t};(C.prototype=new Error).name="InvalidCharacterError";var i=function(t){throw new C(t)},o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=/[\t\n\f\r ]/g,s={encode:function(t){t=String(t),/[^\0-\xFF]/.test(t)&&i("The string to be encoded contains characters outside of the Latin1 range.");for(var g,e,I,C,n=t.length%3,s="",A=-1,c=t.length-n;++A<c;)g=t.charCodeAt(A)<<16,e=t.charCodeAt(++A)<<8,I=t.charCodeAt(++A),s+=o.charAt((C=g+e+I)>>18&63)+o.charAt(C>>12&63)+o.charAt(C>>6&63)+o.charAt(63&C);return 2==n?(g=t.charCodeAt(A)<<8,e=t.charCodeAt(++A),s+=o.charAt((C=g+e)>>10)+o.charAt(C>>4&63)+o.charAt(C<<2&63)+"="):1==n&&(C=t.charCodeAt(A),s+=o.charAt(C>>2)+o.charAt(C<<4&63)+"=="),s},decode:function(t){var g=(t=String(t).replace(n,"")).length;g%4==0&&(g=(t=t.replace(/==?$/,"")).length),(g%4==1||/[^+a-zA-Z0-9/]/.test(t))&&i("Invalid character: the string to be decoded is not correctly encoded.");for(var e,I,C=0,s="",A=-1;++A<g;)I=o.indexOf(t.charAt(A)),e=C%4?64*e+I:I,C++%4&&(s+=String.fromCharCode(255&e>>(-2*C&6)));return s},version:"0.1.0"};if(g&&!g.nodeType)if(e)e.exports=s;else for(var A in s)s.hasOwnProperty(A)&&(g[A]=s[A]);else t.base64=s}(jt);const _t=36e5;function qt(t,g,e,I,C=Date.now){const i=function(t){const g=t.split(".")[1];let e;try{e=JSON.parse(Pt.exports.decode(g))}catch(t){throw new Error("Error decoding Speechly token!")}return{appId:e.appId,projectId:e.projectId,deviceId:e.deviceId,configId:e.configId,scopes:e.scope.split(" "),issuer:e.iss,audience:e.aud,expiresAtMs:1e3*e.exp}}(t);return!(i.expiresAtMs-C()<_t)&&(i.appId===e&&i.projectId===g&&i.deviceId===I)}function tg(t,g,e){var I=void 0===g?null:g,C=function(t,g){var e=atob(t);if(g){for(var I=new Uint8Array(e.length),C=0,i=e.length;C<i;++C)I[C]=e.charCodeAt(C);return String.fromCharCode.apply(null,new Uint16Array(I.buffer))}return e}(t,void 0!==e&&e),i=C.indexOf("\n",10)+1,o=C.substring(i)+(I?"//# sourceMappingURL="+I:""),n=new Blob([o],{type:"application/javascript"});return URL.createObjectURL(n)}var gg=function(t,g,e){var I;return function(C){return I=I||tg(t,g,e),new Worker(I,C)}}("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwp2YXIgd29ya2VyX2NvZGUgPSAoZnVuY3Rpb24gKGV4cG9ydHMpIHsKICAgICd1c2Ugc3RyaWN0JzsKCiAgICAvKioKICAgICAqIEBpbnRlcm5hbAogICAgICovCiAgICBjbGFzcyBBdWRpb1Rvb2xzIHsKICAgICAgICBzdGF0aWMgZG93bnNhbXBsZShzcmMsIGRlc3QsIHNvdXJjZUluZGV4ID0gMCwgc291cmNlTGVuZ3RoID0gLTEsIGRlc3RJbmRleCA9IDAsIGRlc3RMZW5ndGggPSAtMSkgewogICAgICAgICAgICBpZiAoc291cmNlTGVuZ3RoIDwgMCkKICAgICAgICAgICAgICAgIHNvdXJjZUxlbmd0aCA9IHNyYy5sZW5ndGggLSBzb3VyY2VJbmRleDsKICAgICAgICAgICAgaWYgKGRlc3RMZW5ndGggPCAwKQogICAgICAgICAgICAgICAgZGVzdExlbmd0aCA9IGRlc3QubGVuZ3RoIC0gZGVzdEluZGV4OwogICAgICAgICAgICBpZiAoZGVzdExlbmd0aCA+IHNvdXJjZUxlbmd0aCkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW4ndCBkb3duc2FtcGxlOiBzb3VyY2UgYXJyYXkgbGVuZ3RoICgke3NvdXJjZUxlbmd0aH0pIGlzIHNob3J0ZXIgdGhhbiBkZXN0aW5hdGlvbiAoJHtkZXN0TGVuZ3RofSlgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZGVzdExlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW4ndCBkb3duc2FtcGxlOiBzb3VyY2UgYXJyYXkgbGVuZ3RoICgke3NvdXJjZUxlbmd0aH0pIGNhbid0IGJlIGRvd25zYW1wbGVkIHRvIHplcm8tbGVuZ3RoIGRlc3RpbmF0aW9uLmApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzb3VyY2VMZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQ2FuJ3QgZG93bnNhbXBsZTogc291cmNlIHJhbmdlIGNhbid0IGJlIHplcm8gbGVuZ3RoLiIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzb3VyY2VMZW5ndGggPT09IDEpIHsKICAgICAgICAgICAgICAgIGRlc3RbMF0gPSBzcmNbMF07CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGV0IGRlc3RJbmRleEZyYWN0aW9uID0gMC4wOwogICAgICAgICAgICBjb25zdCBkZXN0U3RlcCA9IChkZXN0TGVuZ3RoIC0gMSkgLyAoc291cmNlTGVuZ3RoIC0gMSk7CiAgICAgICAgICAgIGxldCBzdW0gPSAwOwogICAgICAgICAgICBsZXQgdG90YWxXZWlnaHQgPSAwOwogICAgICAgICAgICBjb25zdCBzb3VyY2VFbmRJbmRleCA9IHNvdXJjZUluZGV4ICsgc291cmNlTGVuZ3RoOwogICAgICAgICAgICBmb3IgKDsgc291cmNlSW5kZXggPCBzb3VyY2VFbmRJbmRleDsgc291cmNlSW5kZXgrKykgewogICAgICAgICAgICAgICAgY29uc3Qgd2VpZ2h0ID0gMC41IC0gTWF0aC5hYnMoZGVzdEluZGV4RnJhY3Rpb24pOwogICAgICAgICAgICAgICAgc3VtICs9IHNyY1tzb3VyY2VJbmRleF0gKiB3ZWlnaHQ7CiAgICAgICAgICAgICAgICB0b3RhbFdlaWdodCArPSB3ZWlnaHQ7CiAgICAgICAgICAgICAgICBkZXN0SW5kZXhGcmFjdGlvbiArPSBkZXN0U3RlcDsKICAgICAgICAgICAgICAgIGlmIChkZXN0SW5kZXhGcmFjdGlvbiA+PSAwLjUpIHsKICAgICAgICAgICAgICAgICAgICBkZXN0SW5kZXhGcmFjdGlvbiAtPSAxOwogICAgICAgICAgICAgICAgICAgIGRlc3RbZGVzdEluZGV4KytdID0gc3VtIC8gdG90YWxXZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgc3VtID0gMDsKICAgICAgICAgICAgICAgICAgICB0b3RhbFdlaWdodCA9IDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gUHV0IGxhc3QgdmFsdWUgaW4gcGxhY2UKICAgICAgICAgICAgaWYgKHRvdGFsV2VpZ2h0ID4gMCkgewogICAgICAgICAgICAgICAgZGVzdFtkZXN0SW5kZXgrK10gPSBzdW0gLyB0b3RhbFdlaWdodDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBzdGF0aWMgZ2V0RW5lcmd5KHNhbXBsZXMsIHN0YXJ0ID0gMCwgbGVuZ3RoID0gLTEpIHsKICAgICAgICAgICAgaWYgKGxlbmd0aCA8IDApCiAgICAgICAgICAgICAgICBsZW5ndGggPSBzYW1wbGVzLmxlbmd0aCAtIHN0YXJ0OwogICAgICAgICAgICBpZiAobGVuZ3RoIDw9IDApCiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgY29uc3QgZW5kSW5kZXggPSBzdGFydCArIGxlbmd0aDsKICAgICAgICAgICAgbGV0IHN1bUVuZXJneVNxdWFyZWQgPSAwLjA7CiAgICAgICAgICAgIGZvciAoOyBzdGFydCA8IGVuZEluZGV4OyBzdGFydCsrKSB7CiAgICAgICAgICAgICAgICBzdW1FbmVyZ3lTcXVhcmVkICs9IHNhbXBsZXNbc3RhcnRdICogc2FtcGxlc1tzdGFydF07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIE1hdGguc3FydChzdW1FbmVyZ3lTcXVhcmVkIC8gbGVuZ3RoKTsKICAgICAgICB9CiAgICAgICAgc3RhdGljIGdldEF1ZGlvUGVhayhzYW1wbGVzLCBzdGFydCA9IDAsIGxlbmd0aCA9IC0xKSB7CiAgICAgICAgICAgIGlmIChsZW5ndGggPCAwKQogICAgICAgICAgICAgICAgbGVuZ3RoID0gc2FtcGxlcy5sZW5ndGggLSBzdGFydDsKICAgICAgICAgICAgaWYgKGxlbmd0aCA8PSAwKQogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIGNvbnN0IGVuZEluZGV4ID0gc3RhcnQgKyBsZW5ndGg7CiAgICAgICAgICAgIGxldCBwZWFrID0gMDsKICAgICAgICAgICAgZm9yICg7IHN0YXJ0IDwgZW5kSW5kZXg7IHN0YXJ0KyspIHsKICAgICAgICAgICAgICAgIGlmIChzYW1wbGVzW3N0YXJ0XSA+IHBlYWspIHsKICAgICAgICAgICAgICAgICAgICBwZWFrID0gc2FtcGxlc1tzdGFydF07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHBlYWs7CiAgICAgICAgfQogICAgICAgIHN0YXRpYyBjb252ZXJ0SW50MTZUb0Zsb2F0KHNyYywgZGVzdCwgc3JjU3RhcnRTYW1wbGUgPSAwLCBsZW5ndGhTYW1wbGVzID0gLTEsIGRzdEluZGV4ID0gMCkgewogICAgICAgICAgICBpZiAobGVuZ3RoU2FtcGxlcyA8IDApCiAgICAgICAgICAgICAgICBsZW5ndGhTYW1wbGVzID0gc3JjLmxlbmd0aCAvIDIgLSBzcmNTdGFydFNhbXBsZTsKICAgICAgICAgICAgY29uc3QgbWF4TGVuID0gTWF0aC5taW4oKHNyYy5sZW5ndGggLyAyKSAtIHNyY1N0YXJ0U2FtcGxlLCBkZXN0Lmxlbmd0aCAtIGRzdEluZGV4KTsKICAgICAgICAgICAgbGVuZ3RoU2FtcGxlcyA9IE1hdGgubWluKGxlbmd0aFNhbXBsZXMsIG1heExlbik7CiAgICAgICAgICAgIGlmIChsZW5ndGhTYW1wbGVzIDw9IDApCiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgbGV0IGJ5dGVJbmRleCA9IHNyY1N0YXJ0U2FtcGxlICogMjsKICAgICAgICAgICAgY29uc3QgZW5kQnl0ZSA9IGJ5dGVJbmRleCArIGxlbmd0aFNhbXBsZXMgKiAyOwogICAgICAgICAgICB3aGlsZSAoYnl0ZUluZGV4IDwgZW5kQnl0ZSkgewogICAgICAgICAgICAgICAgZGVzdFtkc3RJbmRleCsrXSA9ICgoc3JjW2J5dGVJbmRleCsrXSArIChzcmNbYnl0ZUluZGV4KytdIDw8IDgpKSkgLyAweDdmZmY7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGxlbmd0aFNhbXBsZXM7CiAgICAgICAgfQogICAgICAgIHN0YXRpYyBjb252ZXJ0RmxvYXRUb0ludDE2KHNyYywgZGVzdCwgc291cmNlSW5kZXggPSAwLCBzb3VyY2VMZW5ndGggPSAtMSwgZHN0SW5kZXggPSAwKSB7CiAgICAgICAgICAgIGlmIChzb3VyY2VMZW5ndGggPCAwKQogICAgICAgICAgICAgICAgc291cmNlTGVuZ3RoID0gc3JjLmxlbmd0aCAtIHNvdXJjZUluZGV4OwogICAgICAgICAgICBjb25zdCBlbmRJbmRleCA9IHNvdXJjZUluZGV4ICsgc291cmNlTGVuZ3RoOwogICAgICAgICAgICB3aGlsZSAoc291cmNlSW5kZXggPCBlbmRJbmRleCkgewogICAgICAgICAgICAgICAgZGVzdFtkc3RJbmRleCsrXSA9IH5+KHNyY1tzb3VyY2VJbmRleCsrXSAqIDB4N2ZmZik7IC8vIFF1aWNrIHRydW5jYXRlLCBubyByb3VuZGluZwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHN0YXRpYyBlbmVyZ3lUb0RiKGVuZXJneSkgewogICAgICAgICAgICByZXR1cm4gKDEwLjAgKiBNYXRoLmxvZyhlbmVyZ3kpIC8gQXVkaW9Ub29scy5MT0dfMl9QTFVTX0xPR181KTsKICAgICAgICB9CiAgICAgICAgc3RhdGljIGRiVG9FbmVyZ3koZGIpIHsKICAgICAgICAgICAgcmV0dXJuIE1hdGgucG93KDEwLjAsIGRiIC8gMTAuMCk7CiAgICAgICAgfQogICAgfQogICAgQXVkaW9Ub29scy5MT0dfMl9QTFVTX0xPR181ID0gTWF0aC5sb2coMikgKyBNYXRoLmxvZyg1KTsKCiAgICAvKioKICAgICAqIEBpbnRlcm5hbAogICAgICovCiAgICBjbGFzcyBBdWRpb1Byb2Nlc3NvciB7CiAgICAgICAgY29uc3RydWN0b3IoaW5wdXRTYW1wbGVSYXRlLCBvdXRwdXRTYW1wbGVSYXRlLCBmcmFtZU1pbGxpcywgaGlzdG9yeUZyYW1lcykgewogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogU2VuZGluZyBzdGF0ZS4gSWYgdHJ1ZSwgQXVkaW9Qcm9jZXNzb3IgaXMgY3VycmVudGx5IHNlbmRpbmcgYXVkaW8gdmlhIG9uU2VuZEF1ZGlvIGNhbGxiYWNrCiAgICAgICAgICAgICAqLwogICAgICAgICAgICB0aGlzLmlzU2VuZGluZyA9IGZhbHNlOwogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogQ3VycmVudCBjb3VudCBvZiBkb3duc2FtcGxlZCBhbmQgY29udGludW91c2x5IHByb2Nlc3NlZCBzYW1wbGVzICh0aHJ1IFByb2Nlc3NBdWRpbykgZnJvbSBzdGFydCBvZiBzdHJlYW0KICAgICAgICAgICAgICovCiAgICAgICAgICAgIHRoaXMuc3RyZWFtU2FtcGxlUG9zID0gMDsKICAgICAgICAgICAgdGhpcy5zYW1wbGVzU2VudCA9IDA7CiAgICAgICAgICAgIHRoaXMudXR0ZXJhbmNlU2VyaWFsID0gLTE7CiAgICAgICAgICAgIHRoaXMub25TZW5kQXVkaW8gPSAoc2FtcGxlcywgc3RhcnRJbmRleCwgbGVuZ3RoKSA9PiB7IH07CiAgICAgICAgICAgIHRoaXMub25WYWRTdGF0ZUNoYW5nZSA9IChpc1NpZ25hbERldGVjdGVkKSA9PiB7IH07CiAgICAgICAgICAgIHRoaXMuaW5wdXRTYW1wbGVSYXRlID0gMTYwMDA7CiAgICAgICAgICAgIHRoaXMuaW50ZXJuYWxTYW1wbGVSYXRlID0gMTYwMDA7CiAgICAgICAgICAgIHRoaXMuaGlzdG9yeUZyYW1lcyA9IDU7CiAgICAgICAgICAgIHRoaXMuZnJhbWVNaWxsaXMgPSAzMDsKICAgICAgICAgICAgdGhpcy5jdXJyZW50RnJhbWVOdW1iZXIgPSAwOwogICAgICAgICAgICB0aGlzLmZyYW1lU2FtcGxlUG9zID0gMDsKICAgICAgICAgICAgdGhpcy5zdHJlYW1GcmFtZVBvcyA9IDA7CiAgICAgICAgICAgIHRoaXMud2FzU2lnbmFsRGV0ZWN0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5pbnB1dFNhbXBsZVJhdGUgPSBpbnB1dFNhbXBsZVJhdGU7CiAgICAgICAgICAgIHRoaXMuaW50ZXJuYWxTYW1wbGVSYXRlID0gb3V0cHV0U2FtcGxlUmF0ZTsKICAgICAgICAgICAgdGhpcy5mcmFtZU1pbGxpcyA9IGZyYW1lTWlsbGlzOwogICAgICAgICAgICB0aGlzLmhpc3RvcnlGcmFtZXMgPSBoaXN0b3J5RnJhbWVzOwogICAgICAgICAgICB0aGlzLmZyYW1lU2FtcGxlcyA9IH5+KHRoaXMuaW50ZXJuYWxTYW1wbGVSYXRlICogdGhpcy5mcmFtZU1pbGxpcyAvIDEwMDApOwogICAgICAgICAgICB0aGlzLnNhbXBsZVJpbmdCdWZmZXIgPSBuZXcgRmxvYXQzMkFycmF5KHRoaXMuZnJhbWVTYW1wbGVzICogdGhpcy5oaXN0b3J5RnJhbWVzKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogUHJvY2VzcyBzcGVlY2ggYXVkaW8gc2FtcGxlcyBmcm9tIGEgbWljcm9waG9uZSBvciBvdGhlciBhdWRpbyBzb3VyY2UuCiAgICAgICAgICoKICAgICAgICAgKiBZb3UgY2FuIGNvbnRyb2wgd2hlbiB0byBzdGFydCBhbmQgc3RvcCBwcm9jZXNzIHNwZWVjaCBlaXRoZXIgbWFudWFsbHkgd2l0aCA8c2VlIGNyZWY9IlN0YXJ0Q29udGV4dCIvPiBhbmQgPHNlZSBjcmVmPSJTdG9wQ29udGV4dCIvPiBvcgogICAgICAgICAqIGF1dG9tYXRpY2FsbHkgYnkgcHJvdmlkaW5nIGEgdm9pY2UgYWN0aXZpdHkgZGV0ZWN0aW9uIChWQUQpIGZpZWxkIHRvIDxzZWUgY3JlZj0iU3BlZWNobHlDbGllbnQiLz4uCiAgICAgICAgICoKICAgICAgICAgKiBUaGUgYXVkaW8gaXMgaGFuZGxlZCBhcyBmb2xsb3dzOgogICAgICAgICAqIC0gRG93bnNhbXBsZSB0byAxNmtIeiBpZiBuZWVkZWQKICAgICAgICAgKiAtIEFkZCB0byBoaXN0b3J5IHJpbmdidWZmZXIKICAgICAgICAgKiAtIENhbGN1bGF0ZSBlbmVyZ3kgKFZBRCkKICAgICAgICAgKiAtIEF1dG9tYXRpYyBTdGFydC9TdG9wQ29udGV4dCAoVkFEKQogICAgICAgICAqIC0gU2VuZCB1dHRlcmFuY2UgYXVkaW8gdG8gU3BlZWNobHkgU0xVIGRlY29kZXIKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBmbG9hdHMgLSBBcnJheSBvZiBmbG9hdCBjb250YWluaW5nIHNhbXBsZXMgdG8gZmVlZCB0byB0aGUgYXVkaW8gcGlwZWxpbmUuIEVhY2ggc2FtcGxlIG5lZWRzIHRvIGJlIGluIHJhbmdlIC0xZi4uMWYuCiAgICAgICAgICogQHBhcmFtIHN0YXJ0IC0gU3RhcnQgaW5kZXggb2YgYXVkaW8gdG8gcHJvY2VzcyBpbiBzYW1wbGVzIChkZWZhdWx0OiBgMGApLgogICAgICAgICAqIEBwYXJhbSBsZW5ndGggLSBMZW5ndGggb2YgYXVkaW8gdG8gcHJvY2VzcyBpbiBzYW1wbGVzIG9yIGAtMWAgdG8gcHJvY2VzcyB0aGUgd2hvbGUgYXJyYXkgKGRlZmF1bHQ6IGAtMWApLgogICAgICAgICAqIEBwYXJhbSBlb3NfYXRfZW5kIC0gU3RvcFN0cmVhbSBpbnRlcm5hbGx5IHVzZXMgdGhpcyB0byBmb3JjZSBwcm9jZXNzaW5nIG9mIGxhc3Qgc3ViZnJhbWUgYXQgZW5kIG9mIGF1ZGlvIHN0cmVhbSAoZGVmYXVsdDogYGZhbHNlYCkuCiAgICAgICAgICogQHJldHVybnMKICAgICAgICAgKi8KICAgICAgICBwcm9jZXNzQXVkaW8oZmxvYXRzLCBzdGFydCA9IDAsIGxlbmd0aCA9IC0xLCBlb3NfYXRfZW5kID0gZmFsc2UpIHsKICAgICAgICAgICAgaWYgKGxlbmd0aCA8IDApCiAgICAgICAgICAgICAgICBsZW5ndGggPSBmbG9hdHMubGVuZ3RoOwogICAgICAgICAgICBpZiAobGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICBpZiAoZW9zX2F0X2VuZCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMucHJvY2Vzc0VvcygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxldCBpID0gc3RhcnQ7CiAgICAgICAgICAgIGNvbnN0IGVuZEluZGV4ID0gc3RhcnQgKyBsZW5ndGg7CiAgICAgICAgICAgIHdoaWxlIChpIDwgZW5kSW5kZXgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGZyYW1lQmFzZSA9IHRoaXMuY3VycmVudEZyYW1lTnVtYmVyICogdGhpcy5mcmFtZVNhbXBsZXM7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5pbnB1dFNhbXBsZVJhdGUgPT09IHRoaXMuaW50ZXJuYWxTYW1wbGVSYXRlKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gQ29weSBpbnB1dCBzYW1wbGVzIHRvIGZpbGwgY3VycmVudCByaW5nYnVmZmVyIGZyYW1lCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2FtcGxlc1RvRmlsbEZyYW1lID0gTWF0aC5taW4oZW5kSW5kZXggLSBpLCB0aGlzLmZyYW1lU2FtcGxlcyAtIHRoaXMuZnJhbWVTYW1wbGVQb3MpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGZyYW1lRW5kSW5kZXggPSB0aGlzLmZyYW1lU2FtcGxlUG9zICsgc2FtcGxlc1RvRmlsbEZyYW1lOwogICAgICAgICAgICAgICAgICAgIHdoaWxlICh0aGlzLmZyYW1lU2FtcGxlUG9zIDwgZnJhbWVFbmRJbmRleCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNhbXBsZVJpbmdCdWZmZXJbZnJhbWVCYXNlICsgdGhpcy5mcmFtZVNhbXBsZVBvcysrXSA9IGZsb2F0c1tpKytdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIERvd25zYW1wbGUgaW5wdXQgc2FtcGxlcyB0byBmaWxsIGN1cnJlbnQgcmluZ2J1ZmZlciBmcmFtZQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJhdGlvID0gMS4wICogdGhpcy5pbnB1dFNhbXBsZVJhdGUgLyB0aGlzLmludGVybmFsU2FtcGxlUmF0ZTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpbnB1dFNhbXBsZXNUb0ZpbGxGcmFtZSA9IE1hdGgubWluKGVuZEluZGV4IC0gaSwgTWF0aC5yb3VuZChyYXRpbyAqICh0aGlzLmZyYW1lU2FtcGxlcyAtIHRoaXMuZnJhbWVTYW1wbGVQb3MpKSk7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2FtcGxlc1RvRmlsbEZyYW1lID0gTWF0aC5taW4oTWF0aC5yb3VuZCgoZW5kSW5kZXggLSBpKSAvIHJhdGlvKSwgdGhpcy5mcmFtZVNhbXBsZXMgLSB0aGlzLmZyYW1lU2FtcGxlUG9zKTsKICAgICAgICAgICAgICAgICAgICBpZiAoc2FtcGxlc1RvRmlsbEZyYW1lID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBBdWRpb1Rvb2xzLmRvd25zYW1wbGUoZmxvYXRzLCB0aGlzLnNhbXBsZVJpbmdCdWZmZXIsIGksIGlucHV0U2FtcGxlc1RvRmlsbEZyYW1lLCBmcmFtZUJhc2UgKyB0aGlzLmZyYW1lU2FtcGxlUG9zLCBzYW1wbGVzVG9GaWxsRnJhbWUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpICs9IGlucHV0U2FtcGxlc1RvRmlsbEZyYW1lOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZnJhbWVTYW1wbGVQb3MgKz0gc2FtcGxlc1RvRmlsbEZyYW1lOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29uc3QgZW9zID0gaSA9PT0gZW5kSW5kZXggJiYgZW9zX2F0X2VuZDsKICAgICAgICAgICAgICAgIC8vIFByb2Nlc3MgZnJhbWUKICAgICAgICAgICAgICAgIGlmICh0aGlzLmZyYW1lU2FtcGxlUG9zID09PSB0aGlzLmZyYW1lU2FtcGxlcyB8fCBlb3MpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdWJGcmFtZVNhbXBsZXMgPSBlb3MgPyB0aGlzLmZyYW1lU2FtcGxlUG9zIDogdGhpcy5mcmFtZVNhbXBsZXM7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9jZXNzRnJhbWUodGhpcy5zYW1wbGVSaW5nQnVmZmVyLCBmcmFtZUJhc2UsIHN1YkZyYW1lU2FtcGxlcywgZW9zKTsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc1NlbmRpbmcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc2FtcGxlc1NlbnQgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN0YXJ0IG9mIHRoZSB1dHRlcmFuY2UgLSBzZW5kIGhpc3RvcnkgZnJhbWVzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzZW5kSGlzdG9yeSA9IE1hdGgubWluKHRoaXMuc3RyZWFtRnJhbWVQb3MsIHRoaXMuaGlzdG9yeUZyYW1lcyAtIDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGhpc3RvcnlGcmFtZUluZGV4ID0gKHRoaXMuY3VycmVudEZyYW1lTnVtYmVyICsgdGhpcy5oaXN0b3J5RnJhbWVzIC0gc2VuZEhpc3RvcnkpICUgdGhpcy5oaXN0b3J5RnJhbWVzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGhpc3RvcnlGcmFtZUluZGV4ICE9PSB0aGlzLmN1cnJlbnRGcmFtZU51bWJlcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25TZW5kQXVkaW8odGhpcy5zYW1wbGVSaW5nQnVmZmVyLCBoaXN0b3J5RnJhbWVJbmRleCAqIHRoaXMuZnJhbWVTYW1wbGVzLCB0aGlzLmZyYW1lU2FtcGxlcyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zYW1wbGVzU2VudCArPSB0aGlzLmZyYW1lU2FtcGxlczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoaXN0b3J5RnJhbWVJbmRleCA9IChoaXN0b3J5RnJhbWVJbmRleCArIDEpICUgdGhpcy5oaXN0b3J5RnJhbWVzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25TZW5kQXVkaW8odGhpcy5zYW1wbGVSaW5nQnVmZmVyLCBmcmFtZUJhc2UsIHN1YkZyYW1lU2FtcGxlcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2FtcGxlc1NlbnQgKz0gc3ViRnJhbWVTYW1wbGVzOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoZW9zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RyZWFtU2FtcGxlUG9zICs9IHN1YkZyYW1lU2FtcGxlczsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9jZXNzRW9zKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuZnJhbWVTYW1wbGVQb3MgPT09IHRoaXMuZnJhbWVTYW1wbGVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZnJhbWVTYW1wbGVQb3MgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0cmVhbUZyYW1lUG9zICs9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RyZWFtU2FtcGxlUG9zICs9IHN1YkZyYW1lU2FtcGxlczsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50RnJhbWVOdW1iZXIgPSAodGhpcy5jdXJyZW50RnJhbWVOdW1iZXIgKyAxKSAlIHRoaXMuaGlzdG9yeUZyYW1lczsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy52YWQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLndhc1NpZ25hbERldGVjdGVkID0gdGhpcy52YWQuaXNTaWduYWxEZXRlY3RlZDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBzZXRTZW5kQXVkaW8oYWN0aXZlKSB7CiAgICAgICAgICAgIHRoaXMuaXNTZW5kaW5nID0gYWN0aXZlOwogICAgICAgICAgICBpZiAoYWN0aXZlKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNhbXBsZXNTZW50ID0gMDsKICAgICAgICAgICAgICAgIHRoaXMudXR0ZXJhbmNlU2VyaWFsKys7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmVzZXQoaW5wdXRTYW1wbGVSYXRlKSB7CiAgICAgICAgICAgIHZhciBfYTsKICAgICAgICAgICAgdGhpcy5pc1NlbmRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5zdHJlYW1GcmFtZVBvcyA9IDA7CiAgICAgICAgICAgIHRoaXMuc3RyZWFtU2FtcGxlUG9zID0gMDsKICAgICAgICAgICAgdGhpcy5mcmFtZVNhbXBsZVBvcyA9IDA7CiAgICAgICAgICAgIHRoaXMuY3VycmVudEZyYW1lTnVtYmVyID0gMDsKICAgICAgICAgICAgdGhpcy51dHRlcmFuY2VTZXJpYWwgPSAtMTsKICAgICAgICAgICAgaWYgKGlucHV0U2FtcGxlUmF0ZSkKICAgICAgICAgICAgICAgIHRoaXMuaW5wdXRTYW1wbGVSYXRlID0gaW5wdXRTYW1wbGVSYXRlOwogICAgICAgICAgICB0aGlzLndhc1NpZ25hbERldGVjdGVkID0gZmFsc2U7CiAgICAgICAgICAgIChfYSA9IHRoaXMudmFkKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucmVzZXRWQUQoKTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQHJldHVybnMgY3VycmVudCBwb3NpdGlvbiBpbiBzdHJlYW0gaW4gbWlsbGlzZWNvbmRzCiAgICAgICAgICovCiAgICAgICAgZ2V0U3RyZWFtUG9zaXRpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBNYXRoLnJvdW5kKHRoaXMuc3RyZWFtU2FtcGxlUG9zIC8gdGhpcy5pbnRlcm5hbFNhbXBsZVJhdGUgKiAxMDAwKTsKICAgICAgICB9CiAgICAgICAgZW9zKCkgewogICAgICAgICAgICB0aGlzLnByb2Nlc3NBdWRpbyh0aGlzLnNhbXBsZVJpbmdCdWZmZXIsIDAsIHRoaXMuZnJhbWVTYW1wbGVQb3MsIHRydWUpOwogICAgICAgIH0KICAgICAgICBwcm9jZXNzRnJhbWUoZmxvYXRzLCBzdGFydCA9IDAsIGxlbmd0aCA9IC0xLCBlb3MgPSBmYWxzZSkgewogICAgICAgICAgICB2YXIgX2E7CiAgICAgICAgICAgIGlmICgoX2EgPSB0aGlzLnZhZCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnZhZE9wdGlvbnMuZW5hYmxlZCkgewogICAgICAgICAgICAgICAgdGhpcy52YWQucHJvY2Vzc0ZyYW1lKGZsb2F0cywgc3RhcnQsIGxlbmd0aCwgZW9zKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnZhZC5pc1NpZ25hbERldGVjdGVkICE9PSB0aGlzLndhc1NpZ25hbERldGVjdGVkKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vblZhZFN0YXRlQ2hhbmdlKHRoaXMudmFkLmlzU2lnbmFsRGV0ZWN0ZWQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHByb2Nlc3NFb3MoKSB7CiAgICAgICAgICAgIHZhciBfYTsKICAgICAgICAgICAgaWYgKHRoaXMuaXNTZW5kaW5nICYmICgoX2EgPSB0aGlzLnZhZCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnZhZE9wdGlvbnMuZW5hYmxlZCkpIHsKICAgICAgICAgICAgICAgIC8vIEVuc3VyZSBWQUQgc3RhdGUgY2hhbmdlIG9uIGVuZC1vZi1zdHJlYW0KICAgICAgICAgICAgICAgIHRoaXMudmFkLnJlc2V0VkFEKCk7CiAgICAgICAgICAgICAgICB0aGlzLm9uVmFkU3RhdGVDaGFuZ2UoZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQWRhcHRpdmUgZW5lcmd5IHRocmVzaG9sZCB2b2ljZSBhY3Rpdml0eSBkZXRlY3Rpb24gKFZBRCkgaW1wbGVtZW50YXRpb24uCiAgICAgKiBJdCBjYW4gYmUgdXNlZCB0byBlbmFibGUgaGFuZHMtZnJlZSBvcGVyYXRpb24gb2YgdGhlIFNMVSBkZWNvZGVyLgogICAgICoKICAgICAqIFdoZW4gZW5vdWdoIGZyYW1lcyB3aXRoIGEgc2lnbmFsIHN0cm9uZ2VyIHRoYW4gU2lnbmFsVG9Ob2lzZURiIGhhdmUgYmVlbiBkZXRlY3RlZCwgSXNTaWduYWxEZXRlY3RlZCBnb2VzIHRydWUuIFdoZW4gZW5vdWdoIHNpbGVudCBmcmFtZXMgaGF2ZSBiZWVuIGRldGVjdGVkLCBJc1NpZ25hbERldGVjdGVkIGdvZXMgZmFsc2UgYWZ0ZXIgdGhlIHN1c3RhaW4gdGltZS4KICAgICAqIFVzZSBpdHMgcHVibGljIGZpZWxkcyB0byBjb25maWd1cmUgdGhlIHN0YXRpYyBub2lzZSBnYXRlIGxldmVsLCBzaWduYWwtdG8tbm9pc2UgbGV2ZWwsIGFjdGl2YXRpb24vZGVhY3RpdmF0aW9uIHRyZXNob2xkIChyYXRpbyBvZiBzaWduYWwgdG8gc2lsZW50IGZyYW1lcykgYW5kIHRoZSBzaWduYWwgc3VzdGFpbiB0aW1lLgogICAgICogVGhlIGJhY2tncm91bmQgbm9pc2UgbGV2ZWwgZ3JhZHVhbGx5IGFkYXB0cyB3aGVuIG5vIHNpZ25hbCBpcyBkZXRlY3RlZC4KICAgICAqCiAgICAgKiBJc1NpZ25hbERldGVjdGVkIGNhbiBiZSB1c2VkIHRvIGRyaXZlIFNwZWVjaGx5Q2xpZW50J3MgU3RhcnRDb250ZXh0IGFuZCBTdG9wQ29udGV4dCBhdXRvbWF0aWNhbGx5IGJ5IHNldHRpbmcgQ29udHJvbExpc3RlbmluZyB0cnVlLgogICAgICogQGludGVybmFsCiAgICAgKi8KICAgIGNsYXNzIEVuZXJneVRyZXNob2xkVkFEIHsKICAgICAgICBjb25zdHJ1Y3RvcihmcmFtZU1pbGxpcywgdmFkT3B0aW9ucykgewogICAgICAgICAgICB0aGlzLmlzU2lnbmFsRGV0ZWN0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5zaWduYWxEYiA9IC05MC4wOwogICAgICAgICAgICB0aGlzLm5vaXNlTGV2ZWxEYiA9IC05MC4wOwogICAgICAgICAgICB0aGlzLmZyYW1lTWlsbGlzID0gMzA7CiAgICAgICAgICAgIHRoaXMuZW5lcmd5ID0gMC4wOwogICAgICAgICAgICB0aGlzLmJhc2VsaW5lRW5lcmd5ID0gLTEuMDsKICAgICAgICAgICAgdGhpcy5sb3VkRnJhbWVCaXRzID0gMDsKICAgICAgICAgICAgdGhpcy52YWRTdXN0YWluTWlsbGlzTGVmdCA9IDA7CiAgICAgICAgICAgIHRoaXMuZnJhbWVNaWxsaXMgPSBmcmFtZU1pbGxpczsKICAgICAgICAgICAgdGhpcy52YWRPcHRpb25zID0gdmFkT3B0aW9uczsKICAgICAgICB9CiAgICAgICAgYWRqdXN0VmFkT3B0aW9ucyh2YWRPcHRpb25zKSB7CiAgICAgICAgICAgIHRoaXMudmFkT3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgdGhpcy52YWRPcHRpb25zKSwgdmFkT3B0aW9ucyk7CiAgICAgICAgfQogICAgICAgIHJlc2V0VkFEKCkgewogICAgICAgICAgICB0aGlzLmlzU2lnbmFsRGV0ZWN0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5sb3VkRnJhbWVCaXRzID0gMDsKICAgICAgICAgICAgdGhpcy5lbmVyZ3kgPSAwOwogICAgICAgICAgICB0aGlzLmJhc2VsaW5lRW5lcmd5ID0gLTE7CiAgICAgICAgfQogICAgICAgIHByb2Nlc3NGcmFtZShmbG9hdHMsIHN0YXJ0ID0gMCwgbGVuZ3RoID0gLTEsIGVvcyA9IGZhbHNlKSB7CiAgICAgICAgICAgIGlmICghdGhpcy52YWRPcHRpb25zLmVuYWJsZWQpIHsKICAgICAgICAgICAgICAgIHRoaXMucmVzZXRWQUQoKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZW9zKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB0aGlzLmVuZXJneSA9IEF1ZGlvVG9vbHMuZ2V0RW5lcmd5KGZsb2F0cywgc3RhcnQsIGxlbmd0aCk7CiAgICAgICAgICAgIGlmICh0aGlzLmJhc2VsaW5lRW5lcmd5IDwgMCkgewogICAgICAgICAgICAgICAgdGhpcy5iYXNlbGluZUVuZXJneSA9IHRoaXMuZW5lcmd5OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGlzTG91ZEZyYW1lID0gdGhpcy5lbmVyZ3kgPiBNYXRoLm1heChBdWRpb1Rvb2xzLmRiVG9FbmVyZ3kodGhpcy52YWRPcHRpb25zLm5vaXNlR2F0ZURiKSwgdGhpcy5iYXNlbGluZUVuZXJneSAqIEF1ZGlvVG9vbHMuZGJUb0VuZXJneSh0aGlzLnZhZE9wdGlvbnMuc2lnbmFsVG9Ob2lzZURiKSk7CiAgICAgICAgICAgIHRoaXMucHVzaEZyYW1lSGlzdG9yeShpc0xvdWRGcmFtZSk7CiAgICAgICAgICAgIHRoaXMuaXNTaWduYWxEZXRlY3RlZCA9IHRoaXMuZGV0ZXJtaW5lTmV3U2lnbmFsU3RhdGUodGhpcy5pc1NpZ25hbERldGVjdGVkKTsKICAgICAgICAgICAgdGhpcy5hZGFwdEJhY2tncm91bmROb2lzZSgpOwogICAgICAgICAgICB0aGlzLnNpZ25hbERiID0gQXVkaW9Ub29scy5lbmVyZ3lUb0RiKHRoaXMuZW5lcmd5IC8gdGhpcy5iYXNlbGluZUVuZXJneSk7CiAgICAgICAgICAgIHRoaXMubm9pc2VMZXZlbERiID0gQXVkaW9Ub29scy5lbmVyZ3lUb0RiKHRoaXMuYmFzZWxpbmVFbmVyZ3kpOwogICAgICAgIH0KICAgICAgICBkZXRlcm1pbmVOZXdTaWduYWxTdGF0ZShjdXJyZW50U3RhdGUpIHsKICAgICAgICAgICAgdGhpcy52YWRTdXN0YWluTWlsbGlzTGVmdCA9IE1hdGgubWF4KHRoaXMudmFkU3VzdGFpbk1pbGxpc0xlZnQgLSB0aGlzLmZyYW1lTWlsbGlzLCAwKTsKICAgICAgICAgICAgY29uc3QgbG91ZEZyYW1lcyA9IHRoaXMuY291bnRMb3VkRnJhbWVzKHRoaXMudmFkT3B0aW9ucy5zaWduYWxTZWFyY2hGcmFtZXMpOwogICAgICAgICAgICBjb25zdCBhY3RpdmF0aW9uRnJhbWVzID0gTWF0aC5yb3VuZCh0aGlzLnZhZE9wdGlvbnMuc2lnbmFsQWN0aXZhdGlvbiAqIHRoaXMudmFkT3B0aW9ucy5zaWduYWxTZWFyY2hGcmFtZXMpOwogICAgICAgICAgICBjb25zdCByZWxlYXNlRnJhbWVzID0gTWF0aC5yb3VuZCh0aGlzLnZhZE9wdGlvbnMuc2lnbmFsUmVsZWFzZSAqIHRoaXMudmFkT3B0aW9ucy5zaWduYWxTZWFyY2hGcmFtZXMpOwogICAgICAgICAgICBpZiAobG91ZEZyYW1lcyA+PSBhY3RpdmF0aW9uRnJhbWVzKSB7CiAgICAgICAgICAgICAgICAvLyBSZW5ldyBzdXN0YWluIHRpbWUKICAgICAgICAgICAgICAgIHRoaXMudmFkU3VzdGFpbk1pbGxpc0xlZnQgPSB0aGlzLnZhZE9wdGlvbnMuc2lnbmFsU3VzdGFpbk1pbGxpczsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChsb3VkRnJhbWVzIDw9IHJlbGVhc2VGcmFtZXMgJiYgdGhpcy52YWRTdXN0YWluTWlsbGlzTGVmdCA9PT0gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBjdXJyZW50U3RhdGU7CiAgICAgICAgfQogICAgICAgIGFkYXB0QmFja2dyb3VuZE5vaXNlKCkgewogICAgICAgICAgICAvLyBHcmFkdWFsbHkgbGVhcm4gYmFja2dyb3VuZCBub2lzZSBsZXZlbAogICAgICAgICAgICBpZiAoIXRoaXMuaXNTaWduYWxEZXRlY3RlZCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMudmFkT3B0aW9ucy5ub2lzZUxlYXJuSGFsZnRpbWVNaWxsaXMgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGRlY2F5ID0gTWF0aC5wb3coMi4wLCAtdGhpcy5mcmFtZU1pbGxpcyAvIHRoaXMudmFkT3B0aW9ucy5ub2lzZUxlYXJuSGFsZnRpbWVNaWxsaXMpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuYmFzZWxpbmVFbmVyZ3kgPSAodGhpcy5iYXNlbGluZUVuZXJneSAqIGRlY2F5KSArICh0aGlzLmVuZXJneSAqICgxIC0gZGVjYXkpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBwdXNoRnJhbWVIaXN0b3J5KGlzTG91ZCkgewogICAgICAgICAgICB0aGlzLmxvdWRGcmFtZUJpdHMgPSAoaXNMb3VkID8gMSA6IDApIHwgKHRoaXMubG91ZEZyYW1lQml0cyA8PCAxKTsKICAgICAgICB9CiAgICAgICAgY291bnRMb3VkRnJhbWVzKG51bUhpc3RvcnlGcmFtZXMpIHsKICAgICAgICAgICAgbGV0IG51bUFjdGl2ZUZyYW1lcyA9IDA7CiAgICAgICAgICAgIGxldCB0ID0gdGhpcy5sb3VkRnJhbWVCaXRzOwogICAgICAgICAgICB3aGlsZSAobnVtSGlzdG9yeUZyYW1lcyA+IDApIHsKICAgICAgICAgICAgICAgIGlmICgodCAmIDEpID09PSAxKQogICAgICAgICAgICAgICAgICAgIG51bUFjdGl2ZUZyYW1lcysrOwogICAgICAgICAgICAgICAgdCA9IHQgPj4gMTsKICAgICAgICAgICAgICAgIG51bUhpc3RvcnlGcmFtZXMtLTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbnVtQWN0aXZlRnJhbWVzOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEtub3duIFdlYlNvY2tldCByZXNwb25zZSB0eXBlcy4KICAgICAqIEBpbnRlcm5hbAogICAgICovCiAgICB2YXIgV2Vic29ja2V0UmVzcG9uc2VUeXBlOwogICAgKGZ1bmN0aW9uIChXZWJzb2NrZXRSZXNwb25zZVR5cGUpIHsKICAgICAgICBXZWJzb2NrZXRSZXNwb25zZVR5cGVbIlN0YXJ0ZWQiXSA9ICJzdGFydGVkIjsKICAgICAgICBXZWJzb2NrZXRSZXNwb25zZVR5cGVbIlN0b3BwZWQiXSA9ICJzdG9wcGVkIjsKICAgICAgICBXZWJzb2NrZXRSZXNwb25zZVR5cGVbIlNlZ21lbnRFbmQiXSA9ICJzZWdtZW50X2VuZCI7CiAgICAgICAgV2Vic29ja2V0UmVzcG9uc2VUeXBlWyJUcmFuc2NyaXB0Il0gPSAidHJhbnNjcmlwdCI7CiAgICAgICAgV2Vic29ja2V0UmVzcG9uc2VUeXBlWyJFbnRpdHkiXSA9ICJlbnRpdHkiOwogICAgICAgIFdlYnNvY2tldFJlc3BvbnNlVHlwZVsiSW50ZW50Il0gPSAiaW50ZW50IjsKICAgICAgICBXZWJzb2NrZXRSZXNwb25zZVR5cGVbIlRlbnRhdGl2ZVRyYW5zY3JpcHQiXSA9ICJ0ZW50YXRpdmVfdHJhbnNjcmlwdCI7CiAgICAgICAgV2Vic29ja2V0UmVzcG9uc2VUeXBlWyJUZW50YXRpdmVFbnRpdGllcyJdID0gInRlbnRhdGl2ZV9lbnRpdGllcyI7CiAgICAgICAgV2Vic29ja2V0UmVzcG9uc2VUeXBlWyJUZW50YXRpdmVJbnRlbnQiXSA9ICJ0ZW50YXRpdmVfaW50ZW50IjsKICAgIH0pKFdlYnNvY2tldFJlc3BvbnNlVHlwZSB8fCAoV2Vic29ja2V0UmVzcG9uc2VUeXBlID0ge30pKTsKICAgIC8qKgogICAgICogTWVzc2FnZXMgZnJvbSB3b3JrZXIgdG8gY29udHJvbGxlcgogICAgICogQGludGVybmFsCiAgICAgKi8KICAgIHZhciBXb3JrZXJTaWduYWw7CiAgICAoZnVuY3Rpb24gKFdvcmtlclNpZ25hbCkgewogICAgICAgIFdvcmtlclNpZ25hbFsiT3BlbmVkIl0gPSAiV0VCU09DS0VUX09QRU4iOwogICAgICAgIFdvcmtlclNpZ25hbFsiQ2xvc2VkIl0gPSAiV0VCU09DS0VUX0NMT1NFRCI7CiAgICAgICAgV29ya2VyU2lnbmFsWyJBdWRpb1Byb2Nlc3NvclJlYWR5Il0gPSAiU09VUkNFX1NBTVBMRV9SQVRFX1NFVF9TVUNDRVNTIjsKICAgICAgICBXb3JrZXJTaWduYWxbIlZhZFNpZ25hbEhpZ2giXSA9ICJWYWRTaWduYWxIaWdoIjsKICAgICAgICBXb3JrZXJTaWduYWxbIlZhZFNpZ25hbExvdyJdID0gIlZhZFNpZ25hbExvdyI7CiAgICAgICAgV29ya2VyU2lnbmFsWyJSZXF1ZXN0Q29udGV4dFN0YXJ0Il0gPSAiUmVxdWVzdENvbnRleHRTdGFydCI7CiAgICB9KShXb3JrZXJTaWduYWwgfHwgKFdvcmtlclNpZ25hbCA9IHt9KSk7CiAgICAvKioKICAgICAqIE1lc3NhZ2VzIGZyb20gY29udHJvbGxlciB0byB3b3JrZXIKICAgICAqIEBpbnRlcm5hbAogICAgICovCiAgICB2YXIgQ29udHJvbGxlclNpZ25hbDsKICAgIChmdW5jdGlvbiAoQ29udHJvbGxlclNpZ25hbCkgewogICAgICAgIENvbnRyb2xsZXJTaWduYWxbImNvbm5lY3QiXSA9ICJjb25uZWN0IjsKICAgICAgICBDb250cm9sbGVyU2lnbmFsWyJpbml0QXVkaW9Qcm9jZXNzb3IiXSA9ICJpbml0QXVkaW9Qcm9jZXNzb3IiOwogICAgICAgIENvbnRyb2xsZXJTaWduYWxbImFkanVzdEF1ZGlvUHJvY2Vzc29yIl0gPSAiYWRqdXN0QXVkaW9Qcm9jZXNzb3IiOwogICAgICAgIENvbnRyb2xsZXJTaWduYWxbIlNFVF9TSEFSRURfQVJSQVlfQlVGRkVSUyJdID0gIlNFVF9TSEFSRURfQVJSQVlfQlVGRkVSUyI7CiAgICAgICAgQ29udHJvbGxlclNpZ25hbFsiQ0xPU0UiXSA9ICJDTE9TRSI7CiAgICAgICAgQ29udHJvbGxlclNpZ25hbFsiU1RBUlRfQ09OVEVYVCJdID0gIlNUQVJUX0NPTlRFWFQiOwogICAgICAgIENvbnRyb2xsZXJTaWduYWxbIlNXSVRDSF9DT05URVhUIl0gPSAiU1dJVENIX0NPTlRFWFQiOwogICAgICAgIENvbnRyb2xsZXJTaWduYWxbIlNUT1BfQ09OVEVYVCJdID0gIlNUT1BfQ09OVEVYVCI7CiAgICAgICAgQ29udHJvbGxlclNpZ25hbFsiQVVESU8iXSA9ICJBVURJTyI7CiAgICAgICAgQ29udHJvbGxlclNpZ25hbFsic3RhcnRTdHJlYW0iXSA9ICJzdGFydFN0cmVhbSI7CiAgICAgICAgQ29udHJvbGxlclNpZ25hbFsic3RvcFN0cmVhbSJdID0gInN0b3BTdHJlYW0iOwogICAgICAgIENvbnRyb2xsZXJTaWduYWxbInNldENvbnRleHRPcHRpb25zIl0gPSAic2V0Q29udGV4dE9wdGlvbnMiOwogICAgfSkoQ29udHJvbGxlclNpZ25hbCB8fCAoQ29udHJvbGxlclNpZ25hbCA9IHt9KSk7CgogICAgY29uc3QgQ09OVFJPTCA9IHsKICAgICAgICBXUklURV9JTkRFWDogMCwKICAgICAgICBGUkFNRVNfQVZBSUxBQkxFOiAxLAogICAgICAgIExPQ0s6IDIsCiAgICB9OwogICAgLyoqCiAgICAgKiBXZWIgd29ya2VyIHRvIGhhbmRsZSBzdHJlYW1pbmcgYXVkaW8gdG8gY2xvdWQgYW5kIHJlY2VpdmluZyBzcGVlY2ggcHJvY2Vzc2luZyByZXN1bHRzLgogICAgICogQWxzbyBoYW5kbGVzIGF1ZGlvIHByb2Nlc3NpbmcgbGlrZSBtYWludGFpbmluZyBoaXN0b3J5IHJpbmdidWZmZXIgYW5kIHJ1bm5pbmcgdGhlIFZBRAogICAgICogQGludGVybmFsCiAgICAgKi8KICAgIGNsYXNzIFdlYnNvY2tldENsaWVudCB7CiAgICAgICAgY29uc3RydWN0b3IoY3R4KSB7CiAgICAgICAgICAgIHRoaXMudGFyZ2V0U2FtcGxlUmF0ZSA9IDE2MDAwOwogICAgICAgICAgICB0aGlzLmlzQ29udGV4dFN0YXJ0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5hdWRpb0NvbnRleHRTdGFydFRpbWVzID0gW107CiAgICAgICAgICAgIHRoaXMuaW1tZWRpYXRlTW9kZSA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmZyYW1lTWlsbGlzID0gMzA7CiAgICAgICAgICAgIHRoaXMub3V0cHV0QXVkaW9GcmFtZSA9IG5ldyBJbnQxNkFycmF5KHRoaXMuZnJhbWVNaWxsaXMgKiB0aGlzLnRhcmdldFNhbXBsZVJhdGUgLyAxMDAwKTsKICAgICAgICAgICAgdGhpcy5kZWJ1ZyA9IGZhbHNlOwogICAgICAgICAgICAvLyBXZWJTb2NrZXQncyBjbG9zZSBoYW5kbGVyLCBjYWxsZWQgd2hlbiBlbmNvdW50ZXJpbmcgYSBub24gdXNlci1pbml0aWF0ZWQgY2xvc2UsIGUuZy4KICAgICAgICAgICAgLy8gLSBuZXR3b3JrIHVucmVhY2hhYmxlIG9yIHVuYWJsZSB0byAocmUpY29ubmVjdCAoY29kZSAxMDA2KQogICAgICAgICAgICAvLyBMaXN0IG9mIENsb3NlRXZlbnQuY29kZSB2YWx1ZXM6IGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9DbG9zZUV2ZW50L2NvZGUKICAgICAgICAgICAgdGhpcy5vbldlYnNvY2tldENsb3NlID0gKGV2ZW50KSA9PiB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5kZWJ1ZykgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbV2ViU29ja2V0Q2xpZW50XScsICdvbldlYnNvY2tldENsb3NlJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlV2Vic29ja2V0KGV2ZW50LmNvZGUsIGV2ZW50LnJlYXNvbiwgZXZlbnQud2FzQ2xlYW4sIGZhbHNlKTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdGhpcy5vbldlYnNvY2tldE9wZW4gPSAoX2V2ZW50KSA9PiB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5kZWJ1ZykgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbV2ViU29ja2V0Q2xpZW50XScsICd3ZWJzb2NrZXQgb3BlbmVkJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLndvcmtlckN0eC5wb3N0TWVzc2FnZSh7IHR5cGU6IFdvcmtlclNpZ25hbC5PcGVuZWQgfSk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHRoaXMub25XZWJzb2NrZXRFcnJvciA9IChfZXZlbnQpID0+IHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1tXZWJTb2NrZXRDbGllbnRdJywgJ3dlYnNvY2tldCBlcnJvcicpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICB0aGlzLm9uV2Vic29ja2V0TWVzc2FnZSA9IChldmVudCkgPT4gewogICAgICAgICAgICAgICAgbGV0IHJlc3BvbnNlOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IEpTT04ucGFyc2UoZXZlbnQuZGF0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tXZWJTb2NrZXRDbGllbnRdJywgJ2Vycm9yIHBhcnNpbmcgcmVzcG9uc2UgZnJvbSB0aGUgc2VydmVyOicsIGUpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS50eXBlID09PSBXZWJzb2NrZXRSZXNwb25zZVR5cGUuU3RhcnRlZCkgewogICAgICAgICAgICAgICAgICAgIC8vIEFwcGVuZCBjbGllbnQtc2lkZSBtZXRhZGF0YSB0byB0aGUgYmFja2VuZCBtZXNzYWdlCiAgICAgICAgICAgICAgICAgICAgbGV0IGF1ZGlvQ29udGV4dFN0YXJ0VGltZSA9IHRoaXMuYXVkaW9Db250ZXh0U3RhcnRUaW1lcy5zaGlmdCgpOwogICAgICAgICAgICAgICAgICAgIGlmIChhdWRpb0NvbnRleHRTdGFydFRpbWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ05vIHZhbGlkIHZhbHVlIGZvciBjb250ZXh0U3RhcnRNaWxsaXMnKTsKICAgICAgICAgICAgICAgICAgICAgICAgYXVkaW9Db250ZXh0U3RhcnRUaW1lID0gMDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhcnRDb250ZXh0UGFyYW1zID0gewogICAgICAgICAgICAgICAgICAgICAgICBhdWRpb1N0YXJ0VGltZU1pbGxpczogYXVkaW9Db250ZXh0U3RhcnRUaW1lLAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UucGFyYW1zID0gc3RhcnRDb250ZXh0UGFyYW1zOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy53b3JrZXJDdHgucG9zdE1lc3NhZ2UocmVzcG9uc2UpOwogICAgICAgICAgICB9OwogICAgICAgICAgICB0aGlzLndvcmtlckN0eCA9IGN0eDsKICAgICAgICB9CiAgICAgICAgY29ubmVjdChhcGlVcmwsIGF1dGhUb2tlbiwgdGFyZ2V0U2FtcGxlUmF0ZSwgZGVidWcpIHsKICAgICAgICAgICAgdGhpcy5kZWJ1ZyA9IGRlYnVnOwogICAgICAgICAgICBpZiAodGhpcy5kZWJ1ZykgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1tXZWJTb2NrZXRDbGllbnRdJywgJ2Nvbm5lY3RpbmcgdG8gJywgYXBpVXJsKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnRhcmdldFNhbXBsZVJhdGUgPSB0YXJnZXRTYW1wbGVSYXRlOwogICAgICAgICAgICB0aGlzLmlzQ29udGV4dFN0YXJ0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy53ZWJzb2NrZXQgPSBuZXcgV2ViU29ja2V0KGFwaVVybCwgYXV0aFRva2VuKTsKICAgICAgICAgICAgdGhpcy53ZWJzb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcignb3BlbicsIHRoaXMub25XZWJzb2NrZXRPcGVuKTsKICAgICAgICAgICAgdGhpcy53ZWJzb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIHRoaXMub25XZWJzb2NrZXRNZXNzYWdlKTsKICAgICAgICAgICAgdGhpcy53ZWJzb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCB0aGlzLm9uV2Vic29ja2V0RXJyb3IpOwogICAgICAgICAgICB0aGlzLndlYnNvY2tldC5hZGRFdmVudExpc3RlbmVyKCdjbG9zZScsIHRoaXMub25XZWJzb2NrZXRDbG9zZSk7CiAgICAgICAgfQogICAgICAgIGluaXRBdWRpb1Byb2Nlc3Nvcihzb3VyY2VTYW1wbGVSYXRlLCBmcmFtZU1pbGxpcywgaGlzdG9yeUZyYW1lcywgdmFkT3B0aW9ucykgewogICAgICAgICAgICB0aGlzLmF1ZGlvUHJvY2Vzc29yID0gbmV3IEF1ZGlvUHJvY2Vzc29yKHNvdXJjZVNhbXBsZVJhdGUsIHRoaXMudGFyZ2V0U2FtcGxlUmF0ZSwgZnJhbWVNaWxsaXMsIGhpc3RvcnlGcmFtZXMpOwogICAgICAgICAgICBpZiAodmFkT3B0aW9ucykgewogICAgICAgICAgICAgICAgdGhpcy5hdWRpb1Byb2Nlc3Nvci52YWQgPSBuZXcgRW5lcmd5VHJlc2hvbGRWQUQoZnJhbWVNaWxsaXMsIHZhZE9wdGlvbnMpOwogICAgICAgICAgICAgICAgdGhpcy5hdWRpb1Byb2Nlc3Nvci5vblZhZFN0YXRlQ2hhbmdlID0gKGlzU2lnbmFsRGV0ZWN0ZWQpID0+IHsKICAgICAgICAgICAgICAgICAgICB2YXIgX2EsIF9iOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRWYWRPcHRpb25zID0gKF9iID0gKF9hID0gdGhpcy5hdWRpb1Byb2Nlc3NvcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnZhZCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnZhZE9wdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFjdXJyZW50VmFkT3B0aW9ucykKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIGlmIChpc1NpZ25hbERldGVjdGVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5pbW1lZGlhdGVNb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLndvcmtlckN0eC5wb3N0TWVzc2FnZSh7IHR5cGU6IFdvcmtlclNpZ25hbC5WYWRTaWduYWxIaWdoIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGN1cnJlbnRWYWRPcHRpb25zLmNvbnRyb2xMaXN0ZW5pbmcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhcnRDb250ZXh0KHRoaXMuZGVmYXVsdENvbnRleHRPcHRpb25zKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoIWlzU2lnbmFsRGV0ZWN0ZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmltbWVkaWF0ZU1vZGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMud29ya2VyQ3R4LnBvc3RNZXNzYWdlKHsgdHlwZTogV29ya2VyU2lnbmFsLlZhZFNpZ25hbExvdyB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChjdXJyZW50VmFkT3B0aW9ucy5jb250cm9sTGlzdGVuaW5nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0b3BDb250ZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuYXVkaW9Qcm9jZXNzb3Iub25TZW5kQXVkaW8gPSAoZmxvYXRzLCBzdGFydEluZGV4LCBsZW5ndGgpID0+IHsKICAgICAgICAgICAgICAgIEF1ZGlvVG9vbHMuY29udmVydEZsb2F0VG9JbnQxNihmbG9hdHMsIHRoaXMub3V0cHV0QXVkaW9GcmFtZSwgc3RhcnRJbmRleCwgbGVuZ3RoKTsKICAgICAgICAgICAgICAgIHRoaXMuc2VuZCh0aGlzLm91dHB1dEF1ZGlvRnJhbWUpOwogICAgICAgICAgICB9OwogICAgICAgICAgICBpZiAodGhpcy53b3JrZXJDdHggPT09IHVuZGVmaW5lZCkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgdGhpcy53b3JrZXJDdHgucG9zdE1lc3NhZ2UoeyB0eXBlOiBXb3JrZXJTaWduYWwuQXVkaW9Qcm9jZXNzb3JSZWFkeSB9KTsKICAgICAgICB9CiAgICAgICAgLyoqCiAgICAgICAgICogQ29udHJvbCBhdWRpbyBwcm9jZXNzb3IgcGFyYW1ldGVycwogICAgICAgICAqIEBwYXJhbSBhcCAtIEF1ZGlvIHByb2Nlc3NvciBwYXJhbWV0ZXJzIHRvIGFkanVzdAogICAgICAgICAqLwogICAgICAgIGFkanVzdEF1ZGlvUHJvY2Vzc29yKGFwKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmF1ZGlvUHJvY2Vzc29yICYmIGFwLnZhZCkgewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLmF1ZGlvUHJvY2Vzc29yLnZhZCkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gVkFEIGluIEF1ZGlvUHJvY2Vzc29yLiBEaWQgeW91IGRlZmluZSBgdmFkYCBpbiBCcm93c2VyQ2xpZW50IGNvbnN0cnVjdG9yIHBhcmFtZXRlcnM/Jyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLmF1ZGlvUHJvY2Vzc29yLnZhZC5hZGp1c3RWYWRPcHRpb25zKGFwLnZhZCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgc2V0U2hhcmVkQXJyYXlCdWZmZXJzKGNvbnRyb2xTQUIsIGRhdGFTQUIpIHsKICAgICAgICAgICAgdGhpcy5jb250cm9sU0FCID0gbmV3IEludDMyQXJyYXkoY29udHJvbFNBQik7CiAgICAgICAgICAgIHRoaXMuZGF0YVNBQiA9IG5ldyBGbG9hdDMyQXJyYXkoZGF0YVNBQik7CiAgICAgICAgICAgIGNvbnN0IGF1ZGlvSGFuZGxlSW50ZXJ2YWwgPSB0aGlzLmRhdGFTQUIubGVuZ3RoIC8gMzI7IC8vIG1zCiAgICAgICAgICAgIGlmICh0aGlzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW1dlYlNvY2tldENsaWVudF0nLCAnQXVkaW8gaGFuZGxlIGludGVydmFsJywgYXVkaW9IYW5kbGVJbnRlcnZhbCwgJ21zJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0SW50ZXJ2YWwodGhpcy5wcm9jZXNzQXVkaW9TQUIuYmluZCh0aGlzKSwgYXVkaW9IYW5kbGVJbnRlcnZhbCk7CiAgICAgICAgfQogICAgICAgIHN0YXJ0U3RyZWFtKHN0cmVhbU9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLmF1ZGlvUHJvY2Vzc29yKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIEF1ZGlvUHJvY2Vzc29yJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5pbW1lZGlhdGVNb2RlID0gc3RyZWFtT3B0aW9ucy5pbW1lZGlhdGU7CiAgICAgICAgICAgIHRoaXMuYXVkaW9Qcm9jZXNzb3IucmVzZXQoc3RyZWFtT3B0aW9ucy5zYW1wbGVSYXRlKTsKICAgICAgICAgICAgdGhpcy5hdWRpb0NvbnRleHRTdGFydFRpbWVzID0gW107CiAgICAgICAgfQogICAgICAgIHN0b3BTdHJlYW0oKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5hdWRpb1Byb2Nlc3NvcikgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBBdWRpb1Byb2Nlc3NvcicpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIFNlbmQgRU9TLiBFbnN1cmUgVkFEIHdpbGwgZ28gb2ZmIGF0IGVuZCBvZiBzdHJlYW0gYW5kIHN0b3BDb250ZXh0IGlzIGNhbGxlZCBpbiBpbW1lZGlhdGUgbW9kZQogICAgICAgICAgICB0aGlzLmF1ZGlvUHJvY2Vzc29yLmVvcygpOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBQcm9jZXNzZXMgYW5kIHNlbmRzIGF1ZGlvCiAgICAgICAgICogQHBhcmFtIGF1ZGlvQ2h1bmsgLSBhdWRpbyBkYXRhIHRvIHByb2Nlc3MKICAgICAgICAgKi8KICAgICAgICBwcm9jZXNzQXVkaW8oYXVkaW9DaHVuaykgewogICAgICAgICAgICBpZiAoIXRoaXMuYXVkaW9Qcm9jZXNzb3IpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gQXVkaW9Qcm9jZXNzb3InKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmF1ZGlvUHJvY2Vzc29yLnByb2Nlc3NBdWRpbyhhdWRpb0NodW5rKTsKICAgICAgICB9CiAgICAgICAgcHJvY2Vzc0F1ZGlvU0FCKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuY29udHJvbFNBQiB8fCAhdGhpcy5kYXRhU0FCKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIFNoYXJlZEFycmF5QnVmZmVycycpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGZyYW1lc0F2YWlsYWJsZSA9IHRoaXMuY29udHJvbFNBQltDT05UUk9MLkZSQU1FU19BVkFJTEFCTEVdOwogICAgICAgICAgICBjb25zdCBsb2NrID0gdGhpcy5jb250cm9sU0FCW0NPTlRST0wuTE9DS107CiAgICAgICAgICAgIGlmIChsb2NrID09PSAwICYmIGZyYW1lc0F2YWlsYWJsZSA+IDApIHsKICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGFTQUIuc3ViYXJyYXkoMCwgZnJhbWVzQXZhaWxhYmxlKTsKICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbFNBQltDT05UUk9MLkZSQU1FU19BVkFJTEFCTEVdID0gMDsKICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbFNBQltDT05UUk9MLldSSVRFX0lOREVYXSA9IDA7CiAgICAgICAgICAgICAgICBpZiAoZGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9jZXNzQXVkaW8oZGF0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgc3RhcnRDb250ZXh0KGNvbnRleHRPcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBfYTsKICAgICAgICAgICAgaWYgKCF0aGlzLmF1ZGlvUHJvY2Vzc29yKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcignTm8gQXVkaW9Qcm9jZXNzb3InKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5pc0NvbnRleHRTdGFydGVkKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbV2ViU29ja2V0Q2xpZW50XScsICJjYW4ndCBzdGFydCBjb250ZXh0OiBhY3RpdmUgY29udGV4dCBleGlzdHMiKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmF1ZGlvUHJvY2Vzc29yLnNldFNlbmRBdWRpbyh0cnVlKTsKICAgICAgICAgICAgdGhpcy5pc0NvbnRleHRTdGFydGVkID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5hdWRpb0NvbnRleHRTdGFydFRpbWVzLnB1c2godGhpcy5hdWRpb1Byb2Nlc3Nvci5nZXRTdHJlYW1Qb3NpdGlvbigpKTsKICAgICAgICAgICAgdGhpcy53b3JrZXJDdHgucG9zdE1lc3NhZ2UoeyB0eXBlOiBXb3JrZXJTaWduYWwuUmVxdWVzdENvbnRleHRTdGFydCB9KTsKICAgICAgICAgICAgbGV0IG9wdGlvbnMgPSAoX2EgPSB0aGlzLmRlZmF1bHRDb250ZXh0T3B0aW9ucykgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDoge307CiAgICAgICAgICAgIGlmIChjb250ZXh0T3B0aW9ucyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBvcHRpb25zID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBvcHRpb25zKSwgY29udGV4dE9wdGlvbnMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBjb250ZXh0T3B0aW9uc1RvTXNnKG9wdGlvbnMpOwogICAgICAgICAgICBtZXNzYWdlLmV2ZW50ID0gJ3N0YXJ0JzsKICAgICAgICAgICAgdGhpcy5zZW5kKEpTT04uc3RyaW5naWZ5KG1lc3NhZ2UpKTsKICAgICAgICB9CiAgICAgICAgc3RvcENvbnRleHQoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5hdWRpb1Byb2Nlc3NvcikgewogICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ05vIEF1ZGlvUHJvY2Vzc29yJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCF0aGlzLmlzQ29udGV4dFN0YXJ0ZWQpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tXZWJTb2NrZXRDbGllbnRdJywgImNhbid0IHN0b3AgY29udGV4dDogbm8gYWN0aXZlIGNvbnRleHQiKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmF1ZGlvUHJvY2Vzc29yLnNldFNlbmRBdWRpbyhmYWxzZSk7CiAgICAgICAgICAgIHRoaXMuaXNDb250ZXh0U3RhcnRlZCA9IGZhbHNlOwogICAgICAgICAgICBjb25zdCBTdG9wRXZlbnRKU09OID0gSlNPTi5zdHJpbmdpZnkoeyBldmVudDogJ3N0b3AnIH0pOwogICAgICAgICAgICB0aGlzLnNlbmQoU3RvcEV2ZW50SlNPTik7CiAgICAgICAgfQogICAgICAgIHN3aXRjaENvbnRleHQoY29udGV4dE9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLndlYnNvY2tldCkgewogICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ1dlYlNvY2tldCBpcyB1bmRlZmluZWQnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIXRoaXMuaXNDb250ZXh0U3RhcnRlZCkgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignW1dlYlNvY2tldENsaWVudF0nLCAiY2FuJ3Qgc3dpdGNoIGNvbnRleHQ6IG5vIGFjdGl2ZSBjb250ZXh0Iik7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKChjb250ZXh0T3B0aW9ucyA9PT0gbnVsbCB8fCBjb250ZXh0T3B0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29udGV4dE9wdGlvbnMuYXBwSWQpID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tXZWJTb2NrZXRDbGllbnRdJywgImNhbid0IHN3aXRjaCBjb250ZXh0OiBuZXcgYXBwIGlkIGlzIHVuZGVmaW5lZCIpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IFN0b3BFdmVudEpTT04gPSBKU09OLnN0cmluZ2lmeSh7IGV2ZW50OiAnc3RvcCcgfSk7CiAgICAgICAgICAgIHRoaXMuc2VuZChTdG9wRXZlbnRKU09OKTsKICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IGNvbnRleHRPcHRpb25zVG9Nc2coY29udGV4dE9wdGlvbnMpOwogICAgICAgICAgICBtZXNzYWdlLmV2ZW50ID0gJ3N0YXJ0JzsKICAgICAgICAgICAgdGhpcy5zZW5kKEpTT04uc3RyaW5naWZ5KG1lc3NhZ2UpKTsKICAgICAgICB9CiAgICAgICAgY2xvc2VXZWJzb2NrZXQoY29kZSA9IDEwMDUsIHJlYXNvbiA9ICdObyBTdGF0dXMgUmVjZWl2ZWQnLCB3YXNDbGVhbiA9IHRydWUsIHVzZXJJbml0aWF0ZWQgPSB0cnVlKSB7CiAgICAgICAgICAgIHZhciBfYTsKICAgICAgICAgICAgaWYgKCF0aGlzLndlYnNvY2tldCkgewogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdXZWJTb2NrZXQgYWxyZWFkeSBjbG9zZWQnKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmICh0aGlzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnW1dlYlNvY2tldENsaWVudF0nLCB1c2VySW5pdGlhdGVkID8gJ1dlYnNvY2tldCBjbG9zZSByZXF1ZXN0ZWQnIDogJ1dlYnNvY2tldCBjbG9zZWQnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBSZXNldCBhdWRpb3Byb2Nlc3NvciBzbyBpdCB3b24ndCB0cnkgdG8gc2VuZCBhdWRpbyB0aGUgZmlyc3QgdGhpbmcgd2hlbiByZWNvbm5lY3QgaGFwcGVucy4gVGhpcyB3aWxsIGxlYWQgdG8gYSByZWNvbm5lY3QgbG9vcC4KICAgICAgICAgICAgKF9hID0gdGhpcy5hdWRpb1Byb2Nlc3NvcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnJlc2V0KCk7CiAgICAgICAgICAgIC8vIFdlIGRvbid0IHdhbnQgYW55IG1vcmUgbWVzc2FnZXMgZnJvbSB0aGUgY2xvc2luZyB3ZWJzb2NrZXQKICAgICAgICAgICAgdGhpcy53ZWJzb2NrZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcignb3BlbicsIHRoaXMub25XZWJzb2NrZXRPcGVuKTsKICAgICAgICAgICAgdGhpcy53ZWJzb2NrZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIHRoaXMub25XZWJzb2NrZXRNZXNzYWdlKTsKICAgICAgICAgICAgdGhpcy53ZWJzb2NrZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcignZXJyb3InLCB0aGlzLm9uV2Vic29ja2V0RXJyb3IpOwogICAgICAgICAgICB0aGlzLndlYnNvY2tldC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbG9zZScsIHRoaXMub25XZWJzb2NrZXRDbG9zZSk7CiAgICAgICAgICAgIC8vIElmIHdlJ3JlIGhlcmUgZHVlIHRvIGEgY2FsbCB0byBvbldlYlNvY2tldAogICAgICAgICAgICBpZiAodXNlckluaXRpYXRlZCkgewogICAgICAgICAgICAgICAgdGhpcy53ZWJzb2NrZXQuY2xvc2UoY29kZSwgcmVhc29uKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLndlYnNvY2tldCA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgdGhpcy53b3JrZXJDdHgucG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgICAgdHlwZTogV29ya2VyU2lnbmFsLkNsb3NlZCwKICAgICAgICAgICAgICAgIGNvZGUsCiAgICAgICAgICAgICAgICByZWFzb24sCiAgICAgICAgICAgICAgICB3YXNDbGVhbiwKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIHNlbmQoZGF0YSkgewogICAgICAgICAgICBpZiAoIXRoaXMud2Vic29ja2V0KSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIFdlYnNvY2tldCcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLndlYnNvY2tldC5yZWFkeVN0YXRlICE9PSB0aGlzLndlYnNvY2tldC5PUEVOKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYEV4cGVjdGVkIE9QRU4gV2Vic29ja2V0IHN0YXRlLCBidXQgZ290ICR7dGhpcy53ZWJzb2NrZXQucmVhZHlTdGF0ZX1gKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdGhpcy53ZWJzb2NrZXQuc2VuZChkYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbV2ViU29ja2V0Q2xpZW50XScsICdzZXJ2ZXIgY29ubmVjdGlvbiBlcnJvcicsIGVycm9yKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBzZXRDb250ZXh0T3B0aW9ucyhvcHRpb25zKSB7CiAgICAgICAgICAgIHRoaXMuZGVmYXVsdENvbnRleHRPcHRpb25zID0gb3B0aW9uczsKICAgICAgICB9CiAgICB9CiAgICBjb25zdCBjdHggPSBzZWxmOwogICAgY29uc3Qgd2Vic29ja2V0Q2xpZW50ID0gbmV3IFdlYnNvY2tldENsaWVudChjdHgpOwogICAgY3R4Lm9ubWVzc2FnZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgc3dpdGNoIChlLmRhdGEudHlwZSkgewogICAgICAgICAgICBjYXNlIENvbnRyb2xsZXJTaWduYWwuY29ubmVjdDoKICAgICAgICAgICAgICAgIHdlYnNvY2tldENsaWVudC5jb25uZWN0KGUuZGF0YS5hcGlVcmwsIGUuZGF0YS5hdXRoVG9rZW4sIGUuZGF0YS50YXJnZXRTYW1wbGVSYXRlLCBlLmRhdGEuZGVidWcpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgQ29udHJvbGxlclNpZ25hbC5pbml0QXVkaW9Qcm9jZXNzb3I6CiAgICAgICAgICAgICAgICB3ZWJzb2NrZXRDbGllbnQuaW5pdEF1ZGlvUHJvY2Vzc29yKGUuZGF0YS5zb3VyY2VTYW1wbGVSYXRlLCBlLmRhdGEuZnJhbWVNaWxsaXMsIGUuZGF0YS5oaXN0b3J5RnJhbWVzLCBlLmRhdGEudmFkT3B0aW9ucyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBDb250cm9sbGVyU2lnbmFsLmFkanVzdEF1ZGlvUHJvY2Vzc29yOgogICAgICAgICAgICAgICAgd2Vic29ja2V0Q2xpZW50LmFkanVzdEF1ZGlvUHJvY2Vzc29yKGUuZGF0YS5wYXJhbXMpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgQ29udHJvbGxlclNpZ25hbC5TRVRfU0hBUkVEX0FSUkFZX0JVRkZFUlM6CiAgICAgICAgICAgICAgICB3ZWJzb2NrZXRDbGllbnQuc2V0U2hhcmVkQXJyYXlCdWZmZXJzKGUuZGF0YS5jb250cm9sU0FCLCBlLmRhdGEuZGF0YVNBQik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBDb250cm9sbGVyU2lnbmFsLkNMT1NFOgogICAgICAgICAgICAgICAgd2Vic29ja2V0Q2xpZW50LmNsb3NlV2Vic29ja2V0KDEwMDAsICdDbG9zZSByZXF1ZXN0ZWQgYnkgY2xpZW50JywgdHJ1ZSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBDb250cm9sbGVyU2lnbmFsLnN0YXJ0U3RyZWFtOgogICAgICAgICAgICAgICAgd2Vic29ja2V0Q2xpZW50LnN0YXJ0U3RyZWFtKGUuZGF0YS5zdHJlYW1PcHRpb25zKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIENvbnRyb2xsZXJTaWduYWwuc3RvcFN0cmVhbToKICAgICAgICAgICAgICAgIHdlYnNvY2tldENsaWVudC5zdG9wU3RyZWFtKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBDb250cm9sbGVyU2lnbmFsLlNUQVJUX0NPTlRFWFQ6CiAgICAgICAgICAgICAgICB3ZWJzb2NrZXRDbGllbnQuc3RhcnRDb250ZXh0KGUuZGF0YS5vcHRpb25zKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIENvbnRyb2xsZXJTaWduYWwuU1dJVENIX0NPTlRFWFQ6CiAgICAgICAgICAgICAgICB3ZWJzb2NrZXRDbGllbnQuc3dpdGNoQ29udGV4dChlLmRhdGEub3B0aW9ucyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBDb250cm9sbGVyU2lnbmFsLlNUT1BfQ09OVEVYVDoKICAgICAgICAgICAgICAgIHdlYnNvY2tldENsaWVudC5zdG9wQ29udGV4dCgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgQ29udHJvbGxlclNpZ25hbC5BVURJTzoKICAgICAgICAgICAgICAgIHdlYnNvY2tldENsaWVudC5wcm9jZXNzQXVkaW8oZS5kYXRhLnBheWxvYWQpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgQ29udHJvbGxlclNpZ25hbC5zZXRDb250ZXh0T3B0aW9uczoKICAgICAgICAgICAgICAgIHdlYnNvY2tldENsaWVudC5zZXRDb250ZXh0T3B0aW9ucyhlLmRhdGEub3B0aW9ucyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdXT1JLRVInLCBlKTsKICAgICAgICB9CiAgICB9OwogICAgZnVuY3Rpb24gY29udGV4dE9wdGlvbnNUb01zZyhjb250ZXh0T3B0aW9ucykgewogICAgICAgIGNvbnN0IG1lc3NhZ2UgPSB7CiAgICAgICAgICAgIG9wdGlvbnM6IHsKICAgICAgICAgICAgICAgIHRpbWV6b25lOiBbSW50bC5EYXRlVGltZUZvcm1hdCgpLnJlc29sdmVkT3B0aW9ucygpLnRpbWVab25lXSwKICAgICAgICAgICAgfSwKICAgICAgICB9OwogICAgICAgIGlmIChjb250ZXh0T3B0aW9ucyA9PT0gdW5kZWZpbmVkKQogICAgICAgICAgICByZXR1cm4gbWVzc2FnZTsKICAgICAgICBtZXNzYWdlLm9wdGlvbnMudm9jYWJ1bGFyeSA9IGNvbnRleHRPcHRpb25zLnZvY2FidWxhcnk7CiAgICAgICAgbWVzc2FnZS5vcHRpb25zLnZvY2FidWxhcnlfYmlhcyA9IGNvbnRleHRPcHRpb25zLnZvY2FidWxhcnlCaWFzOwogICAgICAgIG1lc3NhZ2Uub3B0aW9ucy5zaWxlbmNlX3RyaWdnZXJlZF9zZWdtZW50YXRpb24gPSBjb250ZXh0T3B0aW9ucy5zaWxlbmNlVHJpZ2dlcmVkU2VnbWVudGF0aW9uOwogICAgICAgIGlmIChjb250ZXh0T3B0aW9ucy5ub25TdHJlYW1pbmdObHUpIHsKICAgICAgICAgICAgbWVzc2FnZS5vcHRpb25zLm5vbl9zdHJlYW1pbmdfbmx1ID0gWyd5ZXMnXTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIG1lc3NhZ2Uub3B0aW9ucy5ub25fc3RyZWFtaW5nX25sdSA9IFsnbm8nXTsKICAgICAgICB9CiAgICAgICAgaWYgKChjb250ZXh0T3B0aW9ucyA9PT0gbnVsbCB8fCBjb250ZXh0T3B0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29udGV4dE9wdGlvbnMudGltZXpvbmUpICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgbWVzc2FnZS5vcHRpb25zLnRpbWV6b25lID0gY29udGV4dE9wdGlvbnMgPT09IG51bGwgfHwgY29udGV4dE9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNvbnRleHRPcHRpb25zLnRpbWV6b25lOyAvLyBvdmVycmlkZSBicm93c2VyIHRpbWV6b25lCiAgICAgICAgfQogICAgICAgIGlmIChjb250ZXh0T3B0aW9ucy5hcHBJZCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIG1lc3NhZ2UuYXBwSWQgPSBjb250ZXh0T3B0aW9ucy5hcHBJZDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG1lc3NhZ2U7CiAgICB9CgogICAgZXhwb3J0cy5jb250ZXh0T3B0aW9uc1RvTXNnID0gY29udGV4dE9wdGlvbnNUb01zZzsKICAgIGV4cG9ydHNbImRlZmF1bHQiXSA9IFdlYnNvY2tldENsaWVudDsKCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pOwoKICAgIHJldHVybiBleHBvcnRzOwoKfSkoe30pOwoK",null,!1);class eg{onResponse(t){this.onResponseCb=t}onClose(t){this.onCloseCb=t}constructor(){this.startCbs=[],this.stopCbs=[],this.onResponseCb=()=>{},this.onCloseCb=()=>{},this.onWebsocketMessage=t=>{const g=t.data;switch(g.type){case wt.Opened:this.onInitResolve&&this.onInitResolve();break;case wt.Closed:const e=new Zt(t.data.reason,t.data.code,t.data.wasClean);this.onInitReject?this.onInitReject(e):this.onCloseCb(e);break;case wt.AudioProcessorReady:null!=this.resolveSourceSampleRateSet&&this.resolveSourceSampleRateSet();break;case Rt.Started:this.onResponseCb(g),this.startCbs.forEach((t=>{try{t(void 0,g.audio_context)}catch(t){console.error('[SpeechlyClient] Error while invoking "onStart" callback:',t)}})),this.startCbs.length=0;break;case Rt.Stopped:this.onResponseCb(g),this.stopCbs.forEach((t=>{try{t(void 0,g.audio_context)}catch(t){console.error('[SpeechlyClient] Error while invoking "onStop" callback:',t)}})),this.stopCbs.length=0;break;default:this.onResponseCb(g)}},this.worker=new gg,this.worker.addEventListener("message",this.onWebsocketMessage)}initialize(t,g,e,I){return vt(this,void 0,void 0,(function*(){return this.worker.postMessage({type:Bt.connect,apiUrl:t,authToken:g,targetSampleRate:e,debug:I}),this.startCbs=[],this.stopCbs=[],new Promise(((t,g)=>{this.onInitResolve=()=>{this.onInitResolve=void 0,this.onInitReject=void 0,t()},this.onInitReject=t=>{this.onInitResolve=void 0,this.onInitReject=void 0,g(t)}}))}))}initAudioProcessor(t,g,e,I){return vt(this,void 0,void 0,(function*(){return this.worker.postMessage({type:Bt.initAudioProcessor,sourceSampleRate:t,frameMillis:g,historyFrames:e,vadOptions:I}),new Promise((t=>{this.resolveSourceSampleRateSet=t}))}))}adjustAudioProcessor(t){this.worker.postMessage({type:Bt.adjustAudioProcessor,params:t})}close(){return vt(this,void 0,void 0,(function*(){return new Promise(((t,g)=>{this.worker.postMessage({type:Bt.CLOSE,code:1e3,message:"Client has ended the session"}),t()}))}))}startStream(t){return vt(this,void 0,void 0,(function*(){this.worker.postMessage({type:Bt.startStream,streamOptions:t})}))}stopStream(){return vt(this,void 0,void 0,(function*(){this.worker.postMessage({type:Bt.stopStream})}))}startContext(t){return vt(this,void 0,void 0,(function*(){return new Promise(((g,e)=>{this.startCbs.push(((t,I)=>{void 0!==t?e(t):g(I)})),this.worker.postMessage({type:Bt.START_CONTEXT,options:t})}))}))}stopContext(){return vt(this,void 0,void 0,(function*(){return new Promise(((t,g)=>{this.stopCbs.push(((e,I)=>{void 0!==e?g(e):t(I)})),this.worker.postMessage({type:Bt.STOP_CONTEXT})}))}))}switchContext(t){return vt(this,void 0,void 0,(function*(){return new Promise(((g,e)=>{this.startCbs.push(((t,I)=>{void 0!==t?e(t):g(I)})),this.worker.postMessage({type:Bt.SWITCH_CONTEXT,options:t})}))}))}postMessage(t){this.worker.postMessage(t)}sendAudio(t){this.worker.postMessage({type:Bt.AUDIO,payload:t})}setContextOptions(t){return vt(this,void 0,void 0,(function*(){this.worker.postMessage({type:Bt.setContextOptions,options:t})}))}}class Ig{constructor(){this.storage=window.localStorage}get(t){return this.storage.getItem(t)}set(t,g){this.storage.setItem(t,g)}getOrSet(t,g){let e=this.storage.getItem(t);return null===e&&(e=g(),this.storage.setItem(t,e)),e}}function Cg(t,g){return{intent:t.intent,isFinal:g}}const ig="speechly-auth-token";class og{constructor(t){var g,e;if(this.streamOptions=Nt,this.activeContexts=0,this.audioContexts=new Map,this.maxReconnectAttemptCount=10,this.connectAttempt=0,this.connectPromise=null,this.cbs=[],this.state=Yt.Disconnected,this.handleWebsocketResponse=t=>{var g;switch(this.debug&&console.log("[Decoder]","Received response",t),t.type){case wt.VadSignalHigh:this.cbs.forEach((t=>t.onVadStateChange.forEach((t=>t(!0)))));break;case wt.VadSignalLow:this.cbs.forEach((t=>t.onVadStateChange.forEach((t=>t(!1)))));break;case wt.RequestContextStart:this.activeContexts++;break;case Rt.Started:{const e=t.params;this.audioContexts.set(t.audio_context,{segments:new Map,audioStartTimeMillis:null!==(g=null==e?void 0:e.audioStartTimeMillis)&&void 0!==g?g:0}),this.cbs.forEach((g=>g.contextStartedCbs.forEach((g=>g(t.audio_context)))));break}case Rt.Stopped:this.activeContexts--,this.cbs.forEach((g=>g.contextStoppedCbs.forEach((g=>g(t.audio_context))))),this.streamOptions.preserveSegments||this.audioContexts.delete(t.audio_context),void 0!==this.resolveStopStream&&0===this.activeContexts&&this.resolveStopStream();break;default:this.handleSegmentUpdate(t)}},this.handleSegmentUpdate=t=>{var g;const{audio_context:e,segment_id:I,type:C}=t;let{data:i}=t;const o=this.audioContexts.get(e);if(void 0===o)return void console.warn("[Decoder]","Received response for non-existent context",e);let n=null!==(g=o.segments.get(I))&&void 0!==g?g:new yt(e,I);switch(C){case Rt.TentativeTranscript:const t=function(t,g){return t.words.map((({word:t,index:e,start_timestamp:I,end_timestamp:C})=>({value:t,index:e,startTimestamp:I+g,endTimestamp:C+g,isFinal:!1})))}(i,o.audioStartTimeMillis),g=i.transcript;this.cbs.forEach((C=>C.tentativeTranscriptCbs.forEach((C=>C(e,I,t,g))))),n=n.updateTranscript(t);break;case Rt.Transcript:const C=function(t,g){return{value:t.word,index:t.index,startTimestamp:t.start_timestamp+g,endTimestamp:t.end_timestamp+g,isFinal:!0}}(i,o.audioStartTimeMillis);this.cbs.forEach((t=>t.transcriptCbs.forEach((t=>t(e,I,C))))),n=n.updateTranscript([C]);break;case Rt.TentativeEntities:const s=function(t){return t.entities.map((({entity:t,value:g,start_position:e,end_position:I})=>({type:t,value:g,startPosition:e,endPosition:I,isFinal:!1})))}(i);this.cbs.forEach((t=>t.tentativeEntityCbs.forEach((t=>t(e,I,s))))),n=n.updateEntities(s);break;case Rt.Entity:const A=function(t){return{type:t.entity,value:t.value,startPosition:t.start_position,endPosition:t.end_position,isFinal:!0}}(i);this.cbs.forEach((t=>t.entityCbs.forEach((t=>t(e,I,A))))),n=n.updateEntities([A]);break;case Rt.TentativeIntent:const c=Cg(i,!1);this.cbs.forEach((t=>t.tentativeIntentCbs.forEach((t=>t(e,I,c))))),n=n.updateIntent(c);break;case Rt.Intent:const a=Cg(i,!0);this.cbs.forEach((t=>t.intentCbs.forEach((t=>t(e,I,a))))),n=n.updateIntent(a);break;case Rt.SegmentEnd:n=n.finalize()}o.segments.set(I,n),this.audioContexts.set(e,o),this.logSegments&&console.info(n.toString()),this.cbs.forEach((t=>t.segmentChangeCbs.forEach((t=>t(n.toSegment())))))},this.handleWebsocketClosure=t=>{if(1e3===t.code)this.debug&&console.log("[Decoder]","Websocket closed",t);else{if(console.error("[Decoder]","Websocket closed due to error",t),void 0===this.deviceId)return this.setState(Yt.Failed),void console.error("[Decoder]","No deviceId. Giving up reconnecting.");this.setState(Yt.Disconnected),this.activeContexts=0,this.audioContexts.clear(),this.reconnect()}},this.logSegments=t.logSegments,this.appId=t.appId,this.projectId=t.projectId,this.sampleRate=t.sampleRate,this.debug=t.debug,void 0!==this.appId&&void 0!==this.projectId)throw Error("[Decoder] You cannot use both appId and projectId at the same time");if(void 0===this.appId&&void 0===this.projectId)throw Error("[Decoder] Either an appId or a projectId is required");const I=t.apiUrl;this.apiUrl=function(t,g){const e=new URLSearchParams;return e.append("sampleRate",g.toString()),`${t}?${e.toString()}`}(I.replace("http","ws")+"/ws/v1",this.sampleRate),this.loginUrl=`${I}/login`;try{this.storage=null!==(g=t.storage)&&void 0!==g?g:new Ig,this.deviceId=this.storage.getOrSet("speechly-device-id",Qt)}catch(t){this.deviceId=Qt()}this.apiClient=new eg,this.apiClient.onResponse(this.handleWebsocketResponse),this.apiClient.onClose(this.handleWebsocketClosure),(null===(e=t.connect)||void 0===e||e)&&this.connect()}getReconnectDelayMs(t){return 100*Math.pow(2,t)}sleep(t){return vt(this,void 0,void 0,(function*(){return new Promise((g=>setTimeout(g,t)))}))}connect(){return vt(this,void 0,void 0,(function*(){null===this.connectPromise&&(this.connectPromise=(()=>vt(this,void 0,void 0,(function*(){var t;this.setState(Yt.Disconnected);const g=null===(t=this.storage)||void 0===t?void 0:t.get(ig);if(g&&qt(g,this.projectId,this.appId,this.deviceId))this.authToken=g;else try{this.authToken=yield function(t,g,e,I,C=fetch,i=Date.now){var o;return vt(this,void 0,void 0,(function*(){let n;n=void 0!==g?{projectId:g,deviceId:I}:{appId:e,deviceId:I};const s=yield C(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),A=yield s.json();if(200!==s.status)throw Error(null!==(o=A.error)&&void 0!==o?o:`Speechly API login request failed with ${s.status}`);if(void 0===A.access_token)throw Error("Invalid login response from Speechly API");if(!qt(A.access_token,g,e,I,i))throw Error("Invalid token received from Speechly API");return A.access_token}))}(this.loginUrl,this.projectId,this.appId,this.deviceId,fetch),this.storage&&this.storage.set(ig,this.authToken)}catch(t){throw this.connectPromise=null,this.setState(Yt.Failed),t}try{yield this.apiClient.initialize(this.apiUrl,this.authToken,this.sampleRate,this.debug)}catch(t){throw this.connectPromise=null,t instanceof Zt&&1e3===t.code||this.setState(Yt.Failed),t}this.advanceState(Yt.Connected)})))()),yield this.connectPromise}))}adjustAudioProcessor(t){this.apiClient.adjustAudioProcessor(t)}close(){return vt(this,void 0,void 0,(function*(){let t;try{yield this.apiClient.close()}catch(g){t=g.message}if(this.audioContexts.clear(),this.activeContexts=0,this.connectPromise=null,this.setState(Yt.Disconnected),void 0!==t)throw Error(t)}))}startStream(t){return vt(this,void 0,void 0,(function*(){this.debug&&console.log("[Decoder]","startStream"),this.streamOptions=t,this.audioContexts.clear(),this.activeContexts=0,yield this.apiClient.startStream(t)}))}stopStream(){return vt(this,void 0,void 0,(function*(){this.debug&&console.log("[Decoder]","stopStream"),yield this.apiClient.stopStream(),yield this.waitResults()}))}waitResults(){return vt(this,void 0,void 0,(function*(){if(this.activeContexts>0){const t=new Promise((t=>{this.resolveStopStream=t}));yield t}this.resolveStopStream=void 0}))}startContext(t){return vt(this,void 0,void 0,(function*(){if(this.state===Yt.Failed)throw Error("[Decoder] startContext cannot be run in Failed state.");if(this.state<Yt.Connected)yield this.connect();else if(this.state>Yt.Connected)throw Error("[Decoder] Unable to complete startContext: Expected Connected state, but was in "+Ht(this.state)+".");let g;if(this.setState(Yt.Active),null!=this.projectId){if(!(null==t?void 0:t.appId))throw new Error("options.appId is required with project login");g=yield this.apiClient.startContext(t)}else{if(null!=(null==t?void 0:t.appId)&&this.appId!==(null==t?void 0:t.appId))throw this.setState(Yt.Failed),mt;g=yield this.apiClient.startContext(t)}if(this.state<Yt.Active)throw Error("[Decoder] Unable to complete startContext: Problem acquiring contextId");return g}))}sendAudio(t){this.apiClient.sendAudio(t)}stopContext(t){return vt(this,void 0,void 0,(function*(){if(this.state===Yt.Failed)throw Error("[Decoder] stopContext cannot be run in unrecovable error state.");if(this.state!==Yt.Active)throw Error("[Decoder] Unable to complete stopContext: Expected Active state, but was in "+Ht(this.state)+".");t>0&&(yield this.sleep(t));const g=yield this.apiClient.stopContext();return this.setState(Yt.Connected),g}))}switchContext(t){return vt(this,void 0,void 0,(function*(){if(this.state!==Yt.Active)throw Error("[Decoder] Unable to complete switchContext: Expected Active state, but was in "+Ht(this.state)+".");return yield this.apiClient.switchContext(t)}))}registerListener(t){this.cbs.push(t)}initAudioProcessor(t,g,e,I){return vt(this,void 0,void 0,(function*(){yield this.apiClient.initAudioProcessor(t,g,e,I)}))}useSharedArrayBuffers(t,g){this.apiClient.postMessage({type:"SET_SHARED_ARRAY_BUFFERS",controlSAB:t,dataSAB:g})}setContextOptions(t){return vt(this,void 0,void 0,(function*(){yield this.apiClient.setContextOptions(t)}))}reconnect(){return vt(this,void 0,void 0,(function*(){console.log("Speechly reconnecting"),this.connectPromise=null,this.connectAttempt<this.maxReconnectAttemptCount?(yield this.sleep(this.getReconnectDelayMs(this.connectAttempt++)),yield this.connect()):console.error("[Decoder] Maximum reconnect count reached, giving up automatic reconnect.")}))}advanceState(t){this.state>=t||this.setState(t)}setState(t){this.state!==t&&(this.debug&&console.log("[Decoder]",Ht(this.state),"->",Ht(t)),this.state=t,this.cbs.forEach((g=>{var e;return null===(e=g.stateChangeCbs)||void 0===e?void 0:e.forEach((g=>g(t)))})))}getSegments(){const t=[];return this.audioContexts.forEach(((g,e)=>{g.segments.forEach(((g,e)=>{const I=JSON.parse(JSON.stringify(g));t.push(I)}))})),t}}var ng,sg,Ag,cg,ag,lg;class dg{constructor(t){var g,e;this.contextStopDelay=250,this.debug=!1,this.initialized=!1,this.audioProcessorInitialized=!1,this.isStreaming=!1,this.active=!1,this.listeningPromise=null,this.streamOptions=Object.assign({},Nt),this.stats={maxSignalEnergy:0,sentSamples:0},this.decoderOptions=Object.assign(Object.assign(Object.assign({},Xt),t),{vad:t.vad?Object.assign(Object.assign({},St),t.vad):void 0});const I=window.navigator.mediaDevices.getSupportedConstraints();this.nativeResamplingSupported=!0===I.sampleRate,this.isMobileSafari=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].indexOf(navigator.platform)>=0||navigator.userAgent.includes("Mac")&&"ontouchend"in document,this.isSafari=this.isMobileSafari||void 0!==window.safari,this.useSAB=!this.isSafari,this.debug=null===(g=this.decoderOptions.debug)||void 0===g||g,this.callbacks=new xt,this.callbacks.stateChangeCbs.addEventListener(this.handleStateChange.bind(this)),this.callbacks.onVadStateChange.addEventListener(this.autoControlListening.bind(this)),this.decoder=null!==(e=this.decoderOptions.decoder)&&void 0!==e?e:new og(this.decoderOptions),this.decoder.registerListener(this.callbacks)}initialize(t){var g,e;return vt(this,void 0,void 0,(function*(){if(!this.initialized){this.debug&&console.log("[BrowserClient]","initializing"),this.initialized=!0;try{yield this.decoder.connect()}catch(t){if(this.initialized=!1,t instanceof Zt){if(1e3===t.code)return void(this.debug&&console.log("[BrowserClient]","Early close of websocket."));throw Error(`Unable to connect. Most likely there is no connection to network. Websocket error code: ${t.code}`)}throw t}try{const t={};if(this.nativeResamplingSupported&&(t.sampleRate=Gt),void 0!==window.webkitAudioContext)try{this.audioContext=new window.webkitAudioContext(t)}catch(t){this.debug&&console.log("[BrowserClient]","creating audioContext without samplerate conversion",t),this.audioContext=new window.webkitAudioContext}else this.audioContext=new window.AudioContext(t),void 0!==window.webkitAudioContext&&(yield this.audioContext.resume())}catch(t){throw this.initialized=!1,pt}if(this.isSafari||void 0===window.AudioWorkletNode){if(this.debug&&console.log("[BrowserClient]","using ScriptProcessorNode"),void 0!==window.webkitAudioContext){const t=this.audioContext.sampleRate/Gt,g=4096*Math.pow(2,Math.ceil(Math.log(t)/Math.log(2)));this.audioProcessor=this.audioContext.createScriptProcessor(g,1,1)}else this.audioProcessor=this.audioContext.createScriptProcessor(void 0,1,1);this.audioProcessor.connect(this.audioContext.destination),this.audioProcessor.addEventListener("audioprocess",(t=>{this.handleAudio(t.inputBuffer.getChannelData(0))}))}else{this.debug&&console.log("[BrowserClient]","using AudioWorkletNode");const t=new Blob(["\n// Indices for the Control SAB.\nconst CONTROL = {\n  'WRITE_INDEX': 0,\n  'FRAMES_AVAILABLE': 1,\n  'LOCK': 2,\n};\n\nclass SpeechlyProcessor extends AudioWorkletProcessor {\n  constructor() {\n    super();\n\n    this._initialized = false;\n    this.debug = false;\n    this.port.onmessage = this._initialize.bind(this);\n  }\n\n  _initialize(event) {\n    this.controlSAB = new Int32Array(event.data.controlSAB);\n    this.dataSAB = new Float32Array(event.data.dataSAB);\n    this.debug = event.data.debug;\n    if (this.debug) {\n      console.log('[BrowserClient AudioWorkletNode]', 'initializing audioworklet');\n    }\n    this.sharedBufferSize = this.dataSAB.length;\n    this.buffer = new Float32Array(0);\n    this._initialized = true;\n  }\n\n  _transferDataToSharedBuffer(data) {\n    this.controlSAB[CONTROL.LOCK] = 1;\n    let inputWriteIndex = this.controlSAB[CONTROL.WRITE_INDEX];\n    if (this.controlSAB[CONTROL.FRAMES_AVAILABLE] > 0) {\n      if (inputWriteIndex + data.length > this.sharedBufferSize) {\n        // console.log('buffer overflow')\n        inputWriteIndex = 0;\n      }\n    }\n    this.dataSAB.set(data, inputWriteIndex);\n    this.controlSAB[CONTROL.WRITE_INDEX] = inputWriteIndex + data.length;\n    this.controlSAB[CONTROL.FRAMES_AVAILABLE] = inputWriteIndex + data.length;\n    this.controlSAB[CONTROL.LOCK] = 0;\n  }\n\n  _pushData(data) {\n    if (this.debug) {\n      const signalEnergy = getStandardDeviation(data)\n      this.port.postMessage({\n        type: 'STATS',\n        signalEnergy: signalEnergy,\n        samples: data.length,\n      });\n    }\n\n    if (this.buffer.length > this.sharedBufferSize) {\n      const dataToTransfer = this.buffer.subarray(0, this.sharedBufferSize);\n      this._transferDataToSharedBuffer(dataToTransfer);\n      this.buffer = this.buffer.subarray(this.sharedBufferSize);\n    }\n    let concat = new Float32Array(this.buffer.length + data.length);\n    concat.set(this.buffer);\n    concat.set(data, this.buffer.length);\n    this.buffer = concat;\n  }\n\n  process(inputs, outputs, parameters) {\n    const inputChannelData = inputs[0][0];\n    if (inputChannelData !== undefined) {\n      if (this.controlSAB && this.dataSAB) {\n        this._pushData(inputChannelData);\n      } else {\n        this.port.postMessage({\n          type: 'DATA',\n          frames: inputChannelData\n        });\n      }\n    }\n\n    return true;\n  }\n}\n\nfunction getStandardDeviation(array) {\n  const n = array.length\n  const mean = array.reduce((a, b) => a + b) / n\n  return Math.sqrt(array.map(x => Math.pow(x - mean, 2)).reduce((a, b) => a + b) / n)\n}\n\nregisterProcessor('speechly-worklet', SpeechlyProcessor);\n"],{type:"text/javascript"}),g=window.URL.createObjectURL(t);if(yield this.audioContext.audioWorklet.addModule(g),this.speechlyNode=new AudioWorkletNode(this.audioContext,"speechly-worklet"),this.speechlyNode.connect(this.audioContext.destination),this.useSAB&&void 0!==window.SharedArrayBuffer){this.debug&&console.log("[BrowserClient]","using SharedArrayBuffer");const t=new window.SharedArrayBuffer(4*Int32Array.BYTES_PER_ELEMENT),g=new window.SharedArrayBuffer(1024*Float32Array.BYTES_PER_ELEMENT);this.decoder.useSharedArrayBuffers(t,g),this.speechlyNode.port.postMessage({type:"SET_SHARED_ARRAY_BUFFERS",controlSAB:t,dataSAB:g,debug:this.debug})}else this.debug&&console.log("[BrowserClient]","can not use SharedArrayBuffer");this.speechlyNode.port.onmessage=t=>{switch(t.data.type){case"STATS":t.data.signalEnergy>this.stats.maxSignalEnergy&&(this.stats.maxSignalEnergy=t.data.signalEnergy),this.stats.sentSamples+=parseInt(t.data.samples);break;case"DATA":this.handleAudio(t.data.frames)}}}this.debug&&console.log("[BrowserClient]","audioContext sampleRate is",null===(g=this.audioContext)||void 0===g?void 0:g.sampleRate),this.streamOptions.sampleRate=null===(e=this.audioContext)||void 0===e?void 0:e.sampleRate,yield this.decoder.initAudioProcessor(this.streamOptions.sampleRate,this.decoderOptions.frameMillis,this.decoderOptions.historyFrames,this.decoderOptions.vad),this.audioProcessorInitialized=!0,(null==t?void 0:t.mediaStream)&&(yield this.attach(null==t?void 0:t.mediaStream))}}))}attach(t){var g,e,I,C,i,o;return vt(this,void 0,void 0,(function*(){if(yield this.initialize(),yield this.detach(),this.stream=null===(g=this.audioContext)||void 0===g?void 0:g.createMediaStreamSource(t),"running"!==(null===(e=this.audioContext)||void 0===e?void 0:e.state)&&(this.debug&&console.log("[BrowserClient]","audioContext resume required, state is",null===(I=this.audioContext)||void 0===I?void 0:I.state),yield null===(C=this.audioContext)||void 0===C?void 0:C.resume()),this.speechlyNode)null===(i=this.stream)||void 0===i||i.connect(this.speechlyNode);else{if(!this.audioProcessor)throw Error("[BrowserClient] cannot attach to mediaStream, not initialized");null===(o=this.stream)||void 0===o||o.connect(this.audioProcessor)}yield this.autoControlStream()}))}isActive(){return this.active}start(t){return vt(this,void 0,void 0,(function*(){if(this.active)throw Ft;this.active=!0;return yield this.queueTask((()=>vt(this,void 0,void 0,(function*(){yield this.initialize(),this.isStreaming||(yield this.startStream({autoStarted:!0}));return yield this.decoder.startContext(t)}))))}))}stop(t=this.contextStopDelay){return vt(this,void 0,void 0,(function*(){if(!this.active)throw kt;this.active=!1;return yield this.queueTask((()=>vt(this,void 0,void 0,(function*(){var g;try{const e=yield this.decoder.stopContext(t);return!(null===(g=this.decoderOptions.vad)||void 0===g?void 0:g.enabled)&&this.isStreaming&&this.streamOptions.autoStarted&&(yield this.stopStream()),0===this.stats.sentSamples&&console.warn("[BrowserClient]","audioContext contained no audio data"),e}catch(t){console.warn("[BrowserClient]","stop() failed",t)}finally{this.stats.sentSamples=0}}))))}))}setContextOptions(t){return vt(this,void 0,void 0,(function*(){yield this.decoder.setContextOptions(t)}))}adjustAudioProcessor(t){var g;if(t.vad){if(!this.decoderOptions.vad)throw Error("Unable to adjust VAD - it was not defined in the constructor");this.decoderOptions.vad=Object.assign(Object.assign({},this.decoderOptions.vad),t.vad)}this.decoder.adjustAudioProcessor(t),(null===(g=this.decoderOptions.vad)||void 0===g?void 0:g.enabled)?this.autoControlStream():this.active&&this.stop()}uploadAudioData(t,g){var e,I,C;return vt(this,void 0,void 0,(function*(){yield this.initialize();const i=yield null===(e=this.audioContext)||void 0===e?void 0:e.decodeAudioData(t);if(void 0===i)throw Error("Could not decode audioData");const o=i.getChannelData(0);if(i.numberOfChannels>1){const t=i.getChannelData(1);for(let g=0;g<o.length;g++)o[g]=(o[g]+t[g])/2}this.active&&(yield this.stop(0)),this.isStreaming&&(yield this.stopStream()),yield this.startStream({sampleRate:i.sampleRate,preserveSegments:!0,immediate:!0});const n=(null===(I=this.decoderOptions.vad)||void 0===I?void 0:I.enabled)&&(null===(C=this.decoderOptions.vad)||void 0===C?void 0:C.controlListening),s=1e3;let A,c=0;if(n){if(g&&(yield this.setContextOptions(g)),this.decoderOptions.vad.signalSustainMillis>=s){c=s/(10/(1e4/this.decoderOptions.vad.signalSustainMillis))}else console.warn("Throttling disabled due to low (<= 1000) VAD sustain value. Server may disconnect while processing if contexts are created at high rate.");c=0}else yield this.start(g);const a=Math.round(i.sampleRate*s/1e3);for(let t=0;t<o.length;t+=a){const g=t+a;A=g>o.length?o.slice(t):o.slice(t,g),this.handleAudio(A),yield this.sleep(c)}n||(yield this.stop(0)),yield this.stopStream();return this.decoder.getSegments()}))}startStream(t){return vt(this,void 0,void 0,(function*(){this.streamOptions=Object.assign(Object.assign(Object.assign({},this.streamOptions),{autoStarted:!1}),t),yield this.decoder.startStream(this.streamOptions),this.isStreaming=!0}))}stopStream(){return vt(this,void 0,void 0,(function*(){this.isStreaming&&(this.isStreaming=!1,yield this.decoder.stopStream())}))}queueTask(t){return vt(this,void 0,void 0,(function*(){const g=this.listeningPromise;return this.listeningPromise=(()=>vt(this,void 0,void 0,(function*(){return yield g,t()})))(),this.listeningPromise}))}autoControlListening(t){var g;this.debug&&console.log("[BrowserClient]","autoControlListening",t),(null===(g=this.decoderOptions.vad)||void 0===g?void 0:g.controlListening)&&(t?this.active||this.start():this.active&&this.stop(0))}autoControlStream(){var t,g;return vt(this,void 0,void 0,(function*(){this.audioProcessorInitialized&&this.stream&&(!(null===(t=this.decoderOptions.vad)||void 0===t?void 0:t.enabled)||this.isStreaming?!(null===(g=this.decoderOptions.vad)||void 0===g?void 0:g.enabled)&&this.isStreaming&&this.streamOptions.autoStarted&&(yield this.stopStream()):yield this.startStream({autoStarted:!0}))}))}handleStateChange(t){switch(t){case Yt.Disconnected:case Yt.Failed:this.stopStream(),this.active=!1,this.listeningPromise=null}}detach(){return vt(this,void 0,void 0,(function*(){this.active&&(yield this.stop(0)),this.stream&&(this.stream.disconnect(),this.stream=void 0)}))}close(){var t,g,e;return vt(this,void 0,void 0,(function*(){this.debug&&console.log("[BrowserClient]","close"),yield this.detach(),null!==this.speechlyNode&&(null===(t=this.speechlyNode)||void 0===t||t.port.close(),null===(g=this.speechlyNode)||void 0===g||g.disconnect()),void 0!==this.audioProcessor&&(null===(e=this.audioProcessor)||void 0===e||e.disconnect()),yield this.decoder.close(),this.initialized=!1,this.listeningPromise=null}))}sleep(t){return vt(this,void 0,void 0,(function*(){return new Promise((g=>setTimeout(g,t)))}))}handleAudio(t){this.isStreaming&&(this.stats.sentSamples+=t.length,this.decoder.sendAudio(t))}onStart(t){this.callbacks.contextStartedCbs.addEventListener(t)}onStop(t){this.callbacks.contextStoppedCbs.addEventListener(t)}onSegmentChange(t){this.callbacks.segmentChangeCbs.addEventListener(t)}onTranscript(t){this.callbacks.transcriptCbs.addEventListener(t)}onEntity(t){this.callbacks.entityCbs.addEventListener(t)}onIntent(t){this.callbacks.intentCbs.addEventListener(t)}onTentativeTranscript(t){this.callbacks.tentativeTranscriptCbs.addEventListener(t)}onTentativeEntities(t){this.callbacks.tentativeEntityCbs.addEventListener(t)}onTentativeIntent(t){this.callbacks.tentativeIntentCbs.addEventListener(t)}onStateChange(t){this.callbacks.stateChangeCbs.addEventListener(t)}}!function(t){t.SpeechlyFirstConnect="SpeechlyFirstConnect"}(ng||(ng={})),function(t){t.speechlypoweron="speechlypoweron",t.holdstart="holdstart",t.holdend="holdend",t.speechstate="speechstate",t.audiosourcestate="audiosourcestate",t.speechsegment="speechsegment",t.speechhandled="speechhandled",t.showhint="showhint",t.transcriptdrawerhint="hint",t.speechlyintroready="speechlyintroready",t.speechlyintroclosed="speechlyintroclosed",t.startcontext="startcontext",t.stopcontext="stopcontext",t.requeststartmicrophone="requeststartmicrophone"}(sg||(sg={})),function(t){t.Mic="mic",t.MicActive="micactive",t.Error="error",t.Denied="denied"}(Ag||(Ag={})),function(t){t.Hold="hold",t.Click="click",t.Noninteractive="noninteractive"}(cg||(cg={})),function(t){t.None="none",t.Connecting="connecting",t.Busy="busy"}(ag||(ag={})),function(t){t.None="none",t.Whirl="whirl"}(lg||(lg={}));const rg={[Yt.Disconnected]:{icon:"mic",behaviour:"click",effect:"none",triggerFx:"whirl"},[Yt.Connected]:{icon:"mic",behaviour:"hold",effect:"none",triggerFx:"whirl"},[Yt.Active]:{icon:"micactive",behaviour:"hold",effect:"none"},[Yt.Failed]:{icon:"error",behaviour:"click",effect:"none"},[Vt.NoBrowserSupport]:{icon:"error",behaviour:"click",effect:"none"},[Vt.NoAudioConsent]:{icon:"denied",behaviour:"click",effect:"none"}};function hg(t){u(t,"svelte-s2u2hd",".Icon.svelte-s2u2hd{position:absolute;width:var(--icon-size);height:var(--icon-size);top:50%;left:50%;transform:translate(-50%, -50%);pointer-events:none;transition:0.25s;opacity:var(--icon-opacity)}")}function ug(t){let g,e,I,C,i,o,n,s,A,c,a,l,d;return{c(){g=v("svg"),e=v("linearGradient"),I=v("animate"),C=v("animate"),i=v("stop"),o=v("stop"),n=v("stop"),s=v("stop"),A=v("stop"),c=W(">\n  "),a=v("g"),l=v("path"),d=v("rect"),B(I,"attributeName","y1"),B(I,"values","-200%; 0%;"),B(I,"dur","2s"),B(I,"repeatCount","indefinite"),B(C,"attributeName","y2"),B(C,"values","200%; 400%;"),B(C,"dur","2s"),B(C,"repeatCount","indefinite"),B(i,"offset","0%"),B(i,"stop-color","var(--gradient-stop1)"),B(o,"offset","25%"),B(o,"stop-color","var(--gradient-stop2)"),B(n,"offset","50%"),B(n,"stop-color","var(--gradient-stop1)"),B(s,"offset","75%"),B(s,"stop-color","var(--gradient-stop2)"),B(A,"offset","100%"),B(A,"stop-color","var(--gradient-stop1)"),B(e,"id","gradient"),B(e,"x1","50%"),B(e,"y1","-200%"),B(e,"x2","50%"),B(e,"y2","200%"),B(l,"d","M42 26h4v4c0 9.265-7 16.895-16 17.89V55h-4v-7.11c-8.892-.982-15.833-8.444-15.997-17.56L10 30v-4h4v4c0 7.732 6.268 14 14 14 7.628 0 13.83-6.1 13.997-13.687L42 30v-4z"),B(d,"x","20"),B(d,"y","1"),B(d,"width","16"),B(d,"height","37"),B(d,"rx","8"),B(a,"fill","url(#gradient)"),B(a,"fill-rule","evenodd"),B(g,"class","Icon svelte-s2u2hd"),B(g,"viewBox","0 0 56 56"),B(g,"xmlns","http://www.w3.org/2000/svg")},m(t,r){Z(t,g,r),h(g,e),h(e,I),h(e,C),h(e,i),h(e,o),h(e,n),h(e,s),h(e,A),h(g,c),h(g,a),h(a,l),h(a,d)},d(t){t&&G(g)}}}function bg(t){let g,e,I,C;return{c(){g=v("svg"),e=v("g"),I=v("path"),C=v("rect"),B(I,"d","M42 26h4v4c0 9.265-7 16.895-16 17.89V55h-4v-7.11c-8.892-.982-15.833-8.444-15.997-17.56L10 30v-4h4v4c0 7.732 6.268 14 14 14 7.628 0 13.83-6.1 13.997-13.687L42 30v-4z"),B(C,"x","20"),B(C,"y","1"),B(C,"width","16"),B(C,"height","37"),B(C,"rx","8"),B(e,"fill","var(--icon-color)"),B(e,"fill-rule","evenodd"),B(g,"class","Icon svelte-s2u2hd"),B(g,"viewBox","0 0 56 56"),B(g,"xmlns","http://www.w3.org/2000/svg")},m(t,i){Z(t,g,i),h(g,e),h(e,I),h(e,C)},d(t){t&&G(g)}}}function pg(t){let g,e,I,C;return{c(){g=v("svg"),e=v("g"),I=v("path"),C=v("path"),B(I,"d","M42 26h4v4c0 9.265-7 16.895-16 17.89V55h-4v-7.11c-8.892-.982-15.833-8.444-15.997-17.56L10 30v-4h4v4c0 7.732 6.268 14 14 14 7.628 0 13.83-6.1 13.997-13.687L42 30v-4z"),B(I,"fill-rule","nonzero"),B(C,"d","M37 13.081V31a8 8 0 11-16 0v-1.919l16-16zM26 1a8 8 0 018 8v1.319L18 26.318V9a8 8 0 018-8zM37.969 7.932l3.74-7.35 3.018 2.625zM39.654 10.608l7.531-3.359.695 3.94z"),B(e,"fill","var(--icon-color)"),B(e,"fill-rule","evenodd"),B(g,"class","Icon svelte-s2u2hd"),B(g,"viewBox","0 0 56 56"),B(g,"xmlns","http://www.w3.org/2000/svg")},m(t,i){Z(t,g,i),h(g,e),h(e,I),h(e,C)},d(t){t&&G(g)}}}function mg(t){let g,e,I,C;return{c(){g=v("svg"),e=v("g"),I=v("path"),C=v("path"),B(I,"d","M36 14.828V30a8 8 0 01-15.961.79l15.96-15.962zM28 1a8 8 0 018 8v.172L20 25.173V9a8 8 0 018-8z"),B(C,"d","M42 26h4v4c0 9.265-7 16.895-16 17.89V55h-4v-7.11c-8.892-.982-15.833-8.444-15.997-17.56L10 30v-4h4v4c0 7.732 6.268 14 14 14 7.628 0 13.83-6.1 13.997-13.687L42 30v-4z"),B(e,"fill","var(--icon-color)"),B(e,"fill-rule","nonzero"),B(g,"class","Icon svelte-s2u2hd"),B(g,"viewBox","0 0 56 56"),B(g,"xmlns","http://www.w3.org/2000/svg")},m(t,i){Z(t,g,i),h(g,e),h(e,I),h(e,C)},d(t){t&&G(g)}}}function Zg(g){let e,I,C,i,o=g[0]===Ag.MicActive&&ug(),n=g[0]===Ag.Mic&&bg(),s=g[0]===Ag.Error&&pg(),A=g[0]===Ag.Denied&&mg();return{c(){o&&o.c(),e=V(),n&&n.c(),I=V(),s&&s.c(),C=V(),A&&A.c(),i=R()},m(t,g){o&&o.m(t,g),Z(t,e,g),n&&n.m(t,g),Z(t,I,g),s&&s.m(t,g),Z(t,C,g),A&&A.m(t,g),Z(t,i,g)},p(t,[g]){t[0]===Ag.MicActive?o||(o=ug(),o.c(),o.m(e.parentNode,e)):o&&(o.d(1),o=null),t[0]===Ag.Mic?n||(n=bg(),n.c(),n.m(I.parentNode,I)):n&&(n.d(1),n=null),t[0]===Ag.Error?s||(s=pg(),s.c(),s.m(C.parentNode,C)):s&&(s.d(1),s=null),t[0]===Ag.Denied?A||(A=mg(),A.c(),A.m(i.parentNode,i)):A&&(A.d(1),A=null)},i:t,o:t,d(t){o&&o.d(t),t&&G(e),n&&n.d(t),t&&G(I),s&&s.d(t),t&&G(C),A&&A.d(t),t&&G(i)}}}function Gg(t,g,e){let{icon:I=Ag.Mic}=g;return t.$$set=t=>{"icon"in t&&e(0,I=t.icon)},[I]}class yg extends dt{constructor(t){super(),at(this,t,Gg,Zg,o,{icon:0},hg)}}function vg(t){u(t,"svelte-1fpkb0k",".Fx.svelte-1fpkb0k{position:absolute;width:var(--fx-size);height:var(--fx-size);top:50%;left:50%;transform-origin:50% 50%;transform:translate(-50%, -50%) rotate(var(--fx-rotation));pointer-events:none;opacity:var(--fx-opacity)}")}function Wg(g){let e,I,C,i,o,n,s,A;return{c(){e=v("svg"),I=v("defs"),C=v("linearGradient"),i=v("stop"),o=v("stop"),n=v("filter"),s=v("feGaussianBlur"),A=v("circle"),B(i,"stop-color","var(--fx-gradient-stop1)"),B(i,"offset","0%"),B(o,"stop-color","var(--fx-gradient-stop2)"),B(o,"offset","100%"),B(C,"x1","50%"),B(C,"y1","10%"),B(C,"x2","50%"),B(C,"y2","100%"),B(C,"id","a"),B(s,"stdDeviation","18"),B(s,"in","SourceGraphic"),B(n,"x","-35%"),B(n,"y","-35%"),B(n,"width","170%"),B(n,"height","170%"),B(n,"filterUnits","objectBoundingBox"),B(n,"id","b"),B(A,"filter","url(#b)"),B(A,"cx","124"),B(A,"cy","124"),B(A,"r","79"),B(A,"fill","url(#a)"),B(A,"fillrule","evenodd"),B(e,"class","Fx svelte-1fpkb0k"),B(e,"viewBox","0 0 246 246"),B(e,"xmlns","http://www.w3.org/2000/svg")},m(t,g){Z(t,e,g),h(e,I),h(I,C),h(C,i),h(C,o),h(I,n),h(n,s),h(e,A)},p:t,i:t,o:t,d(t){t&&G(e)}}}class Vg extends dt{constructor(t){super(),at(this,t,null,Wg,o,{},vg)}}const{window:Rg}=ot;function wg(t){let g;return{c(){g=y("link"),B(g,"href",t[9]),B(g,"rel","stylesheet")},m(t,e){Z(t,g,e)},p(t,e){512&e[0]&&B(g,"href",t[9])},d(t){t&&G(g)}}}function Bg(g){let e,I,i,o,n,s,A,c,a,l,d,r,u=void 0!==g[9]&&wg(g);return i=new Vg({}),n=new bt({props:{frameRadius:g[16]}}),A=new yg({props:{icon:g[15].icon}}),{c(){u&&u.c(),e=V(),I=y("main"),nt(i.$$.fragment),o=V(),nt(n.$$.fragment),s=V(),nt(A.$$.fragment),c=V(),a=y("slot"),this.c=t,B(I,"class","HoldableButton"),X(I,"width",g[0]),X(I,"height",g[0]),X(I,"--gradient-stop1",g[5]),X(I,"--gradient-stop2",g[6]),X(I,"--fx-gradient-stop1",g[7]||g[5]),X(I,"--fx-gradient-stop2",g[8]||g[6]),X(I,"--fx-rotation",g[11][1]+"deg"),X(I,"--fx-opacity",g[14][1]),X(I,"--fx-size",g[2]),X(I,"--icon-opacity",g[13][1]),X(I,"--icon-size",g[1]),X(I,"--icon-color",g[4]),X(I,"--frame-stroke-width",g[17]),X(I,"--frame-background",g[3]),X(I,"transform","scale("+g[12][1]+")"),S(I,"pressed",g[10])},m(t,C){u&&u.m(t,C),Z(t,e,C),Z(t,I,C),st(i,I,null),h(I,o),st(n,I,null),h(I,s),st(A,I,null),h(I,c),h(I,a),l=!0,d||(r=[w(Rg,"mouseup",g[19]),w(Rg,"keydown",g[20]),w(Rg,"keyup",g[21]),w(I,"mousedown",g[18]),w(I,"touchstart",g[18]),w(I,"dragstart",g[18]),w(I,"mouseup",g[19]),w(I,"touchend",g[19],{passive:!0}),w(I,"dragend",g[19])],d=!0)},p(t,g){void 0!==t[9]?u?u.p(t,g):(u=wg(t),u.c(),u.m(e.parentNode,e)):u&&(u.d(1),u=null);const C={};65536&g[0]&&(C.frameRadius=t[16]),n.$set(C);const i={};32768&g[0]&&(i.icon=t[15].icon),A.$set(i),(!l||1&g[0])&&X(I,"width",t[0]),(!l||1&g[0])&&X(I,"height",t[0]),(!l||32&g[0])&&X(I,"--gradient-stop1",t[5]),(!l||64&g[0])&&X(I,"--gradient-stop2",t[6]),(!l||160&g[0])&&X(I,"--fx-gradient-stop1",t[7]||t[5]),(!l||320&g[0])&&X(I,"--fx-gradient-stop2",t[8]||t[6]),(!l||2048&g[0])&&X(I,"--fx-rotation",t[11][1]+"deg"),(!l||16384&g[0])&&X(I,"--fx-opacity",t[14][1]),(!l||4&g[0])&&X(I,"--fx-size",t[2]),(!l||8192&g[0])&&X(I,"--icon-opacity",t[13][1]),(!l||2&g[0])&&X(I,"--icon-size",t[1]),(!l||16&g[0])&&X(I,"--icon-color",t[4]),(!l||131072&g[0])&&X(I,"--frame-stroke-width",t[17]),(!l||8&g[0])&&X(I,"--frame-background",t[3]),(!l||4096&g[0])&&X(I,"transform","scale("+t[12][1]+")"),(!l||1024&g[0])&&S(I,"pressed",t[10])},i(t){l||(It(i.$$.fragment,t),It(n.$$.fragment,t),It(A.$$.fragment,t),l=!0)},o(t){Ct(i.$$.fragment,t),Ct(n.$$.fragment,t),Ct(A.$$.fragment,t),l=!1},d(t){u&&u.d(t),t&&G(e),t&&G(I),At(i),At(n),At(A),d=!1,C(r)}}}function fg(t,g,e){let I,C,i,o,{icon:n=Yt.Disconnected}=g,{capturekey:s=" "}=g,{hide:A}=g,{size:c="80px"}=g,{holdscale:a="1.35"}=g,{borderscale:l="0.075"}=g,{iconsize:d="60%"}=g,{fxsize:r="250%"}=g,{backgroundcolor:h="#ffffff"}=g,{iconcolor:u="#000000"}=g,{gradientstop1:b="#15e8b5"}=g,{gradientstop2:p="#4fa1f9"}=g,{fxgradientstop1:m}=g,{fxgradientstop2:Z}=g,{customcssurl:G}=g;let y=!1,v=0,W=[0,0],V=[0,0],R=[1,1],w=[0,0],B=rg[n],f=null,X=0,S=0;const N=J(),Y=(t,g)=>{N.dispatchEvent(new CustomEvent(t,{detail:g,composed:!0}))};K((()=>{e(12,V=[1,0]);let t=null;const g=()=>{X=S,S=(new Date).getTime();const C=S-(X||S);B.effect===ag.Connecting&&e(13,R[0]=.25*Math.cos(S/2500*Math.PI*2)+.25,R),B.effect===ag.Busy&&e(13,R[0]=.25*Math.cos(S/1e3*Math.PI*2)+.25,R),e(12,V=[V[0],F(V[1],I?V[0]:0,.2,C)]),e(13,R=[R[0],F(R[1],R[0],.08,C)]),e(14,w=[w[0],F(w[1],w[0],.08,C)]),e(11,W=[W[0]+2.5,F(W[1],W[0],.05,C)]),t=requestAnimationFrame(g)};return g(),()=>cancelAnimationFrame(t)}));const z=t=>{t.preventDefault(),t.stopPropagation(),I&&!y&&(e(10,y=!0),v=Date.now(),k(),B.triggerFx===lg.Whirl&&e(11,W[0]+=720,W),B.behaviour===cg.Click&&null===f&&(f=window.setTimeout((()=>{e(14,w[0]=0,w),f=null}),500)),N.onholdstart&&N.onholdstart(),Y(sg.holdstart))},x=()=>{if(y){e(10,y=!1);const t={timeMs:Date.now()-v};k(),null!==f&&window.clearTimeout(f),N.onholdend&&N.onholdend(t),Y("holdend",t)}},F=(t,g,e,I)=>t*(1-(e=Math.pow(e,1e3/60/I)))+g*e,k=(t=5)=>{void 0!==navigator.vibrate&&navigator.vibrate(t)};return t.$$set=t=>{"icon"in t&&e(22,n=t.icon),"capturekey"in t&&e(23,s=t.capturekey),"hide"in t&&e(24,A=t.hide),"size"in t&&e(0,c=t.size),"holdscale"in t&&e(25,a=t.holdscale),"borderscale"in t&&e(26,l=t.borderscale),"iconsize"in t&&e(1,d=t.iconsize),"fxsize"in t&&e(2,r=t.fxsize),"backgroundcolor"in t&&e(3,h=t.backgroundcolor),"iconcolor"in t&&e(4,u=t.iconcolor),"gradientstop1"in t&&e(5,b=t.gradientstop1),"gradientstop2"in t&&e(6,p=t.gradientstop2),"fxgradientstop1"in t&&e(7,m=t.fxgradientstop1),"fxgradientstop2"in t&&e(8,Z=t.fxgradientstop2),"customcssurl"in t&&e(9,G=t.customcssurl)},t.$$.update=()=>{16777216&t.$$.dirty[0]&&(I=void 0===A||"false"===A),67108864&t.$$.dirty[0]&&e(17,C=""+46*l),67108864&t.$$.dirty[0]&&e(16,i=46-23*l),33554432&t.$$.dirty[0]&&(o=a),4195328&t.$$.dirty[0]&&((t,g)=>{switch(e(15,B=rg[g]),e(12,V[0]=t?o:1,V),e(14,w[0]=t||g==Yt.Active?1:0,w),B.icon){case Ag.MicActive:case Ag.Mic:case Ag.Denied:case Ag.Error:e(13,R[0]=1,R)}})(y,n)},[c,d,r,h,u,b,p,m,Z,G,y,W,V,R,w,B,i,C,z,x,t=>{s&&(t.key===s&&(document.hasFocus()&&document.activeElement!==document.body&&document.activeElement!==document.documentElement&&document.activeElement||null||(t.repeat?(t.preventDefault(),t.stopPropagation()):z(t))))},t=>{t.key===s&&x()},n,s,A,a,l,()=>y]}class Xg extends lt{constructor(t){super(),this.shadowRoot.innerHTML="<style>main{text-align:left;position:relative;pointer-events:auto;cursor:pointer;border-radius:50%;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none !important;-webkit-user-select:none !important}</style>",at(this,{target:this.shadowRoot,props:N(this.attributes),customElement:!0},fg,Bg,n,{icon:22,capturekey:23,hide:24,size:0,holdscale:25,borderscale:26,iconsize:1,fxsize:2,backgroundcolor:3,iconcolor:4,gradientstop1:5,gradientstop2:6,fxgradientstop1:7,fxgradientstop2:8,customcssurl:9,isbuttonpressed:27},null,[-1,-1]),t&&(t.target&&Z(t.target,this,t.anchor),t.props&&(this.$set(t.props),P()))}static get observedAttributes(){return["icon","capturekey","hide","size","holdscale","borderscale","iconsize","fxsize","backgroundcolor","iconcolor","gradientstop1","gradientstop2","fxgradientstop1","fxgradientstop2","customcssurl","isbuttonpressed"]}get icon(){return this.$$.ctx[22]}set icon(t){this.$$set({icon:t}),P()}get capturekey(){return this.$$.ctx[23]}set capturekey(t){this.$$set({capturekey:t}),P()}get hide(){return this.$$.ctx[24]}set hide(t){this.$$set({hide:t}),P()}get size(){return this.$$.ctx[0]}set size(t){this.$$set({size:t}),P()}get holdscale(){return this.$$.ctx[25]}set holdscale(t){this.$$set({holdscale:t}),P()}get borderscale(){return this.$$.ctx[26]}set borderscale(t){this.$$set({borderscale:t}),P()}get iconsize(){return this.$$.ctx[1]}set iconsize(t){this.$$set({iconsize:t}),P()}get fxsize(){return this.$$.ctx[2]}set fxsize(t){this.$$set({fxsize:t}),P()}get backgroundcolor(){return this.$$.ctx[3]}set backgroundcolor(t){this.$$set({backgroundcolor:t}),P()}get iconcolor(){return this.$$.ctx[4]}set iconcolor(t){this.$$set({iconcolor:t}),P()}get gradientstop1(){return this.$$.ctx[5]}set gradientstop1(t){this.$$set({gradientstop1:t}),P()}get gradientstop2(){return this.$$.ctx[6]}set gradientstop2(t){this.$$set({gradientstop2:t}),P()}get fxgradientstop1(){return this.$$.ctx[7]}set fxgradientstop1(t){this.$$set({fxgradientstop1:t}),P()}get fxgradientstop2(){return this.$$.ctx[8]}set fxgradientstop2(t){this.$$set({fxgradientstop2:t}),P()}get customcssurl(){return this.$$.ctx[9]}set customcssurl(t){this.$$set({customcssurl:t}),P()}get isbuttonpressed(){return this.$$.ctx[27]}}function Sg(e){let I,o,n,s,A,a,l,d,u,b;return{c(){I=y("div"),o=y("div"),o.innerHTML="<slot></slot>",n=V(),s=y("div"),A=V(),B(o,"class","CalloutDiv"),S(o,"useShadow",zg),B(s,"class","ArrowDiv"),X(s,"--ax",e[3].x),X(s,"--ay","100%"),B(I,"class","CalloutContainerDiv"),X(I,"width",e[1])},m(t,g){Z(t,I,g),h(I,o),h(I,n),h(I,s),h(I,A),d=!0,u||(b=[w(I,"mousedown",e[7]),w(I,"touchstart",e[7]),w(I,"dragstart",e[7])],u=!0)},p(t,g){(!d||8&g)&&X(s,"--ax",t[3].x),(!d||2&g)&&X(I,"width",t[1])},i(C){d||(Q((()=>{l&&l.end(1),a=function(e,I,C){const o={direction:"in"};let n,s,A=I(e,C,o),a=!1,l=0;function d(){n&&k(e,n)}function h(){const{delay:I=0,duration:C=300,easing:i=g,tick:o=t,css:h}=A||it;h&&(n=F(e,0,1,C,I,i,h,l++)),o(0,1);const u=c()+I,b=u+C;s&&s.abort(),a=!0,Q((()=>tt(e,!0,"start"))),s=r((t=>{if(a){if(t>=b)return o(1,0),tt(e,!0,"end"),d(),a=!1;if(t>=u){const g=i((t-u)/C);o(g,1-g)}}return a}))}let u=!1;return{start(){u||(u=!0,k(e),i(A)?(A=A(o),q().then(h)):h())},invalidate(){u=!1},end(){a&&(d(),a=!1)}}}(I,e[6],{}),a.start()})),d=!0)},o(o){a&&a.invalidate(),l=function(e,I,o){const n={direction:"out"};let s,A=I(e,o,n),a=!0;const l=et;function d(){const{delay:I=0,duration:i=300,easing:o=g,tick:n=t,css:d}=A||it;d&&(s=F(e,1,0,i,I,o,d));const h=c()+I,u=h+i;Q((()=>tt(e,!1,"start"))),r((t=>{if(a){if(t>=u)return n(0,1),tt(e,!1,"end"),--l.r||C(l.c),!1;if(t>=h){const g=o((t-h)/i);n(1-g,g)}}return a}))}return l.r+=1,i(A)?q().then((()=>{A=A(n),d()})):d(),{end(t){t&&A.tick&&A.tick(1,0),a&&(s&&k(e,s),a=!1)}}}(I,e[6],{}),d=!1},d(t){t&&G(I),t&&l&&l.end(),u=!1,C(b)}}}function Ng(g){let e,I,i=g[2]&&Sg(g);return{c(){e=y("main"),i&&i.c(),this.c=t,X(e,"--ax",g[4].x),X(e,"--ay",g[4].y),X(e,"--halign",g[3].x),X(e,"--valign",g[3].y),X(e,"--borderradius",xg),X(e,"--arrowpad",`${g[5].value}${g[5].unit}`),X(e,"--backgroundcolor",g[0]),X(e,"--size",`${g[5].value*Math.sqrt(2)}${g[5].unit}`),X(e,"--offsetx","0rem"),X(e,"--offsety",`${g[5].value}${g[5].unit}`)},m(t,g){Z(t,e,g),i&&i.m(e,null),I=!0},p(t,[g]){t[2]?i?(i.p(t,g),4&g&&It(i,1)):(i=Sg(t),i.c(),It(i,1),i.m(e,null)):i&&(et={r:0,c:[],p:et},Ct(i,1,1,(()=>{i=null})),et.r||C(et.c),et=et.p),(!I||8&g)&&X(e,"--halign",t[3].x),(!I||8&g)&&X(e,"--valign",t[3].y),(!I||1&g)&&X(e,"--backgroundcolor",t[0])},i(t){I||(It(i),I=!0)},o(t){Ct(i),I=!1},d(t){t&&G(e),i&&i.d()}}}customElements.get("holdable-button")?console.warn("Skipping re-defining customElement holdable-button"):customElements.define("holdable-button",Xg);const Yg=500;let zg=!1,xg="0rem";function Fg(t,g,e){let I,{show:C}=g,{showtime:i=1e4}=g,{backgroundcolor:o="#202020"}=g,{xalign:n="50%"}=g,{width:s="auto"}=g,A=null,c=!1;const a=(l=(t,{duration:g=250})=>({duration:g,css:t=>`\n          clip-path: circle(${100*t}% at ${I.x} 50%);\n        `}),function(t,g){if(!t.hasOwnProperty("ownerDocument")){Object.defineProperty(t,"ownerDocument",{get:function(){return t.parentElement}});let g=t;for(;g.parentElement;)g=g.parentElement;t.parentElement.head=g}return l(t,g)});var l;return t.$$set=t=>{"show"in t&&e(8,C=t.show),"showtime"in t&&e(9,i=t.showtime),"backgroundcolor"in t&&e(0,o=t.backgroundcolor),"xalign"in t&&e(10,n=t.xalign),"width"in t&&e(1,s=t.width)},t.$$.update=()=>{1024&t.$$.dirty&&e(3,I={x:n,y:"100%"}),256&t.$$.dirty&&(t=>{null!==A&&(window.clearTimeout(A),A=null),void 0!==t&&"false"!==t?A=window.setTimeout((()=>{e(2,c=!0),A=null,i>0&&(A=window.setTimeout((()=>{e(2,c=!1),A=null}),i))}),Yg):e(2,c=!1)})(C)},[o,s,c,I,{x:"50%",y:"10%"},{value:.55,unit:"rem"},a,t=>{t.preventDefault(),t.stopPropagation(),e(2,c=!1)},C,i,n]}class kg extends lt{constructor(t){super(),this.shadowRoot.innerHTML="<style>main{margin:0;padding:0}.CalloutContainerDiv{position:absolute;left:var(--ax);top:var(--ay);transform:translate(calc(-1 * var(--halign)), calc(-1 * var(--valign)));padding:var(--arrowpad);z-index:10;pointer-events:auto}.CalloutDiv{position:relative;box-sizing:border-box;min-width:8rem;border-radius:var(--borderradius);padding:0.50rem 1rem;background-color:var(--backgroundcolor);text-align:center;user-select:none;z-index:10}.useShadow{box-shadow:0 0.2rem 0.5rem #00000040}.ArrowDiv{position:absolute;left:calc(var(--ax) - var(--offsetx));top:calc(var(--ay) - var(--offsety));transform:translate(-50%, -50%) rotate(45deg);width:var(--size);height:var(--size);background-color:var(--backgroundcolor);z-index:10}.ArrowShadowDiv{position:absolute;left:calc(var(--ax) - var(--offsetx));top:calc(var(--ay) - var(--offsety));transform:translate(-50%, -50%) rotate(45deg);width:var(--size);height:var(--size);background-color:var(--backgroundcolor);background-color:#00000000;box-shadow:0 0.2rem 0.5rem #00000040;z-index:9}</style>",at(this,{target:this.shadowRoot,props:N(this.attributes),customElement:!0},Fg,Ng,n,{show:8,showtime:9,backgroundcolor:0,xalign:10,width:1},null),t&&(t.target&&Z(t.target,this,t.anchor),t.props&&(this.$set(t.props),P()))}static get observedAttributes(){return["show","showtime","backgroundcolor","xalign","width"]}get show(){return this.$$.ctx[8]}set show(t){this.$$set({show:t}),P()}get showtime(){return this.$$.ctx[9]}set showtime(t){this.$$set({showtime:t}),P()}get backgroundcolor(){return this.$$.ctx[0]}set backgroundcolor(t){this.$$set({backgroundcolor:t}),P()}get xalign(){return this.$$.ctx[10]}set xalign(t){this.$$set({xalign:t}),P()}get width(){return this.$$.ctx[1]}set width(t){this.$$set({width:t}),P()}}customElements.get("call-out")?console.warn("Skipping re-defining customElement call-out"):customElements.define("call-out",kg);const Hg=()=>{const t=J();return(g,e)=>{t.dispatchEvent(new CustomEvent(g,{detail:e,composed:!0}))}},{document:Jg,window:Kg}=ot;function Tg(t){let g;return{c(){g=y("link"),B(g,"href","https://fonts.googleapis.com/css2?family=Saira+Condensed:wght@700&display=swap"),B(g,"rel","stylesheet")},m(t,e){Z(t,g,e)},d(t){t&&G(g)}}}function Ug(g){let e,I,i,o,n,s,A,c,a=g[25]&&Tg();return{c(){a&&a.c(),e=R(),I=V(),i=y("holdable-button"),o=y("call-out"),n=W(g[24]),this.c=t,f(o,"width",g[7]),f(o,"xalign",g[6]),f(o,"show",s=""!==g[24]&&g[22]&&!g[1]?"true":"false"),f(o,"showtime",g[5]),f(o,"backgroundcolor",g[16]),S(o,"defaultTypography",g[25]),f(i,"size",g[3]),f(i,"icon",g[23]),f(i,"capturekey",g[0]),f(i,"gradientstop1",g[10]),f(i,"gradientstop2",g[11]),f(i,"fxgradientstop1",g[12]),f(i,"fxgradientstop2",g[13]),f(i,"hide",g[1]),f(i,"backgroundcolor",g[8]),f(i,"iconcolor",g[9]),f(i,"holdscale",g[17]),f(i,"borderscale",g[18]),f(i,"iconsize",g[19]),f(i,"fxsize",g[20]),f(i,"customcssurl",g[21]),X(i,"--voffset",g[4]),X(i,"--size",g[3]),X(i,"--textcolor",g[15]),X(i,"--fontsize",g[14]),S(i,"placementBottom","bottom"===g[2])},m(t,C){a&&a.m(Jg.head,null),h(Jg.head,e),Z(t,I,C),Z(t,i,C),h(i,o),h(o,n),A||(c=[w(Kg,"message",g[28]),w(i,"holdstart",g[26]),w(i,"holdend",g[27])],A=!0)},p(t,g){t[25]?a||(a=Tg(),a.c(),a.m(e.parentNode,e)):a&&(a.d(1),a=null),16777216&g[0]&&function(t,g){g=""+g,t.wholeText!==g&&(t.data=g)}(n,t[24]),128&g[0]&&f(o,"width",t[7]),64&g[0]&&f(o,"xalign",t[6]),20971522&g[0]&&s!==(s=""!==t[24]&&t[22]&&!t[1]?"true":"false")&&f(o,"show",s),32&g[0]&&f(o,"showtime",t[5]),65536&g[0]&&f(o,"backgroundcolor",t[16]),33554432&g[0]&&S(o,"defaultTypography",t[25]),8&g[0]&&f(i,"size",t[3]),8388608&g[0]&&f(i,"icon",t[23]),1&g[0]&&f(i,"capturekey",t[0]),1024&g[0]&&f(i,"gradientstop1",t[10]),2048&g[0]&&f(i,"gradientstop2",t[11]),4096&g[0]&&f(i,"fxgradientstop1",t[12]),8192&g[0]&&f(i,"fxgradientstop2",t[13]),2&g[0]&&f(i,"hide",t[1]),256&g[0]&&f(i,"backgroundcolor",t[8]),512&g[0]&&f(i,"iconcolor",t[9]),131072&g[0]&&f(i,"holdscale",t[17]),262144&g[0]&&f(i,"borderscale",t[18]),524288&g[0]&&f(i,"iconsize",t[19]),1048576&g[0]&&f(i,"fxsize",t[20]),2097152&g[0]&&f(i,"customcssurl",t[21]),16&g[0]&&X(i,"--voffset",t[4]),8&g[0]&&X(i,"--size",t[3]),32768&g[0]&&X(i,"--textcolor",t[15]),16384&g[0]&&X(i,"--fontsize",t[14]),4&g[0]&&S(i,"placementBottom","bottom"===t[2])},i:t,o:t,d(t){a&&a.d(t),G(e),t&&G(I),t&&G(i),A=!1,C(c)}}}const Eg=600,Mg=1500;function Dg(t,g,e){let I,C;var i=this&&this.__awaiter||function(t,g,e,I){return new(e||(e=Promise))((function(C,i){function o(t){try{s(I.next(t))}catch(t){i(t)}}function n(t){try{s(I.throw(t))}catch(t){i(t)}}function s(t){var g;t.done?C(t.value):(g=t.value,g instanceof e?g:new e((function(t){t(g)}))).then(o,n)}s((I=I.apply(t,g||[])).next())}))};const o=Hg();let n,{projectid:s}=g,{appid:A}=g,{apiurl:c}=g,{capturekey:a=" "}=g,{poweron:l="auto"}=g,{hide:d}=g,{taptotalktime:r=8e3}=g,{silencetohanguptime:h=1e3}=g,{placement:u}=g,{size:b="80px"}=g,{voffset:p="40px"}=g,{intro:m="Hold to talk"}=g,{hint:Z="Hold to talk"}=g,{showtime:G=1e4}=g,{hintxalign:y="50%"}=g,{hintwidth:v="auto"}=g,{backgroundcolor:W="#ffffff"}=g,{iconcolor:V="#000000"}=g,{gradientstop1:R="#15e8b5"}=g,{gradientstop2:w="#4fa1f9"}=g,{fxgradientstop1:B}=g,{fxgradientstop2:f}=g,{fontsize:X="1.0rem"}=g,{textcolor:S="#ffffff"}=g,{hintbackgroundcolor:N="#202020"}=g,{holdscale:Y="1.35"}=g,{borderscale:z="0.075"}=g,{iconsize:x="60%"}=g,{fxsize:F="250%"}=g,{customcssurl:k}=g,{customtypography:H}=g,J=!1,T=!1,U=!1,E=!1,M=!1,D=null,$=null,Q=Yt.Disconnected,L=null,O=null,j=Yt.Disconnected,P=Vt.Stopped,_=null;K((()=>{switch(M=!0,l){case"true":J=!0;break;case"auto":q(document.querySelector("intro-popup"))}tt(s,A)}));const q=t=>{null===_&&null!==t&&(_=t,t.addEventListener(sg.requeststartmicrophone,(()=>i(void 0,void 0,void 0,(function*(){yield L.initialize(),yield O.initialize(),yield L.attach(O.mediaStream)})))),J=null===localStorage.getItem(ng.SpeechlyFirstConnect))},tt=(t,g)=>{if(M&&!L&&(t||g)){const I=Object.assign(Object.assign(Object.assign({connect:!1},g&&!t&&{appId:g}),t&&{projectId:t}),c&&{apiUrl:c});L=new dg(I),L.onStateChange(Ct),L.onSegmentChange((t=>{D&&gt(h),o(sg.speechsegment,t),window.postMessage({type:sg.speechsegment,segment:t},"*")})),O=new ft,O.onStateChange(it),L.initialize(),e(22,E=!0)}},gt=t=>{D&&window.clearTimeout(D),D=window.setTimeout((()=>{D=null,et()}),t)},et=()=>{L&&(L.stop(),o(sg.stopcontext)),It()},It=()=>{switch(P){case Vt.NoAudioConsent:case Vt.NoBrowserSupport:e(23,Q=P);break;default:e(23,Q=j)}},Ct=t=>{j=t,It(),window.postMessage({type:sg.speechstate,state:t},"*"),ot()},it=t=>{P=t,window.postMessage({type:sg.audiosourcestate,state:t},"*"),ot(),It()},ot=()=>{void 0===n&&j===Yt.Connected&&P===Vt.Started&&(n=!0,J=!1,null===localStorage.getItem(ng.SpeechlyFirstConnect)&&localStorage.setItem(ng.SpeechlyFirstConnect,String(Date.now())))};return t.$$set=t=>{"projectid"in t&&e(29,s=t.projectid),"appid"in t&&e(30,A=t.appid),"apiurl"in t&&e(31,c=t.apiurl),"capturekey"in t&&e(0,a=t.capturekey),"poweron"in t&&e(32,l=t.poweron),"hide"in t&&e(1,d=t.hide),"taptotalktime"in t&&e(33,r=t.taptotalktime),"silencetohanguptime"in t&&e(34,h=t.silencetohanguptime),"placement"in t&&e(2,u=t.placement),"size"in t&&e(3,b=t.size),"voffset"in t&&e(4,p=t.voffset),"intro"in t&&e(35,m=t.intro),"hint"in t&&e(36,Z=t.hint),"showtime"in t&&e(5,G=t.showtime),"hintxalign"in t&&e(6,y=t.hintxalign),"hintwidth"in t&&e(7,v=t.hintwidth),"backgroundcolor"in t&&e(8,W=t.backgroundcolor),"iconcolor"in t&&e(9,V=t.iconcolor),"gradientstop1"in t&&e(10,R=t.gradientstop1),"gradientstop2"in t&&e(11,w=t.gradientstop2),"fxgradientstop1"in t&&e(12,B=t.fxgradientstop1),"fxgradientstop2"in t&&e(13,f=t.fxgradientstop2),"fontsize"in t&&e(14,X=t.fontsize),"textcolor"in t&&e(15,S=t.textcolor),"hintbackgroundcolor"in t&&e(16,N=t.hintbackgroundcolor),"holdscale"in t&&e(17,Y=t.holdscale),"borderscale"in t&&e(18,z=t.borderscale),"iconsize"in t&&e(19,x=t.iconsize),"fxsize"in t&&e(20,F=t.fxsize),"customcssurl"in t&&e(21,k=t.customcssurl),"customtypography"in t&&e(37,H=t.customtypography)},t.$$.update=()=>{16&t.$$.dirty[1]&&e(24,I=m),1610612736&t.$$.dirty[0]&&tt(s,A),64&t.$$.dirty[1]&&e(25,C=void 0===H||"false"===H)},[a,d,u,b,p,G,y,v,W,V,R,w,B,f,X,S,N,Y,z,x,F,k,E,Q,I,C,t=>i(void 0,void 0,void 0,(function*(){$=i(void 0,void 0,void 0,(function*(){if(e(22,E=!1),D&&(window.clearTimeout(D),D=null),L){if(J)window.postMessage({type:sg.speechlypoweron},"*");else if(j>=Yt.Connected&&P===Vt.Started)T=!0;else if(A||s)try{const t=Date.now();yield L.initialize(),yield O.initialize(),yield L.attach(O.mediaStream),T=Date.now()-t<Mg}catch(t){console.error("Speechly initialization failed - ",t),T=!1}else console.warn("No appid/projectid attribute specified. Speechly voice services are unavailable.");T&&(U=L.isActive(),L.isActive()||(o(sg.startcontext),L.start(A)))}window.postMessage({type:sg.holdstart,state:j,audioSourceState:P},"*")}))})),t=>i(void 0,void 0,void 0,(function*(){if(yield $,L&&T){T=!1;t.detail.timeMs<Eg?0==r?(et(),e(24,I=Z),e(22,E=!0)):U?et():gt(r):et()}window.postMessage({type:sg.holdend},"*")})),t=>{switch(t.data.type){case sg.showhint:e(24,I=t.data.hint),e(22,E=!0);break;case sg.speechlyintroready:"auto"===l&&q(document.querySelector("intro-popup"))}},s,A,c,l,r,h,m,Z,H]}class $g extends lt{constructor(t){super(),this.shadowRoot.innerHTML="<style>.placementBottom{position:fixed;bottom:0;left:0;right:0;height:calc(var(--size) + var(--voffset));max-height:100vh;pointer-events:none;display:flex;flex-direction:row;justify-content:center;z-index:50}call-out.defaultTypography{font-family:'Saira Condensed', sans-serif;color:var(--textcolor);font-size:var(--fontsize);line-height:120%;text-transform:uppercase}</style>",at(this,{target:this.shadowRoot,props:N(this.attributes),customElement:!0},Dg,Ug,n,{projectid:29,appid:30,apiurl:31,capturekey:0,poweron:32,hide:1,taptotalktime:33,silencetohanguptime:34,placement:2,size:3,voffset:4,intro:35,hint:36,showtime:5,hintxalign:6,hintwidth:7,backgroundcolor:8,iconcolor:9,gradientstop1:10,gradientstop2:11,fxgradientstop1:12,fxgradientstop2:13,fontsize:14,textcolor:15,hintbackgroundcolor:16,holdscale:17,borderscale:18,iconsize:19,fxsize:20,customcssurl:21,customtypography:37},null,[-1,-1]),t&&(t.target&&Z(t.target,this,t.anchor),t.props&&(this.$set(t.props),P()))}static get observedAttributes(){return["projectid","appid","apiurl","capturekey","poweron","hide","taptotalktime","silencetohanguptime","placement","size","voffset","intro","hint","showtime","hintxalign","hintwidth","backgroundcolor","iconcolor","gradientstop1","gradientstop2","fxgradientstop1","fxgradientstop2","fontsize","textcolor","hintbackgroundcolor","holdscale","borderscale","iconsize","fxsize","customcssurl","customtypography"]}get projectid(){return this.$$.ctx[29]}set projectid(t){this.$$set({projectid:t}),P()}get appid(){return this.$$.ctx[30]}set appid(t){this.$$set({appid:t}),P()}get apiurl(){return this.$$.ctx[31]}set apiurl(t){this.$$set({apiurl:t}),P()}get capturekey(){return this.$$.ctx[0]}set capturekey(t){this.$$set({capturekey:t}),P()}get poweron(){return this.$$.ctx[32]}set poweron(t){this.$$set({poweron:t}),P()}get hide(){return this.$$.ctx[1]}set hide(t){this.$$set({hide:t}),P()}get taptotalktime(){return this.$$.ctx[33]}set taptotalktime(t){this.$$set({taptotalktime:t}),P()}get silencetohanguptime(){return this.$$.ctx[34]}set silencetohanguptime(t){this.$$set({silencetohanguptime:t}),P()}get placement(){return this.$$.ctx[2]}set placement(t){this.$$set({placement:t}),P()}get size(){return this.$$.ctx[3]}set size(t){this.$$set({size:t}),P()}get voffset(){return this.$$.ctx[4]}set voffset(t){this.$$set({voffset:t}),P()}get intro(){return this.$$.ctx[35]}set intro(t){this.$$set({intro:t}),P()}get hint(){return this.$$.ctx[36]}set hint(t){this.$$set({hint:t}),P()}get showtime(){return this.$$.ctx[5]}set showtime(t){this.$$set({showtime:t}),P()}get hintxalign(){return this.$$.ctx[6]}set hintxalign(t){this.$$set({hintxalign:t}),P()}get hintwidth(){return this.$$.ctx[7]}set hintwidth(t){this.$$set({hintwidth:t}),P()}get backgroundcolor(){return this.$$.ctx[8]}set backgroundcolor(t){this.$$set({backgroundcolor:t}),P()}get iconcolor(){return this.$$.ctx[9]}set iconcolor(t){this.$$set({iconcolor:t}),P()}get gradientstop1(){return this.$$.ctx[10]}set gradientstop1(t){this.$$set({gradientstop1:t}),P()}get gradientstop2(){return this.$$.ctx[11]}set gradientstop2(t){this.$$set({gradientstop2:t}),P()}get fxgradientstop1(){return this.$$.ctx[12]}set fxgradientstop1(t){this.$$set({fxgradientstop1:t}),P()}get fxgradientstop2(){return this.$$.ctx[13]}set fxgradientstop2(t){this.$$set({fxgradientstop2:t}),P()}get fontsize(){return this.$$.ctx[14]}set fontsize(t){this.$$set({fontsize:t}),P()}get textcolor(){return this.$$.ctx[15]}set textcolor(t){this.$$set({textcolor:t}),P()}get hintbackgroundcolor(){return this.$$.ctx[16]}set hintbackgroundcolor(t){this.$$set({hintbackgroundcolor:t}),P()}get holdscale(){return this.$$.ctx[17]}set holdscale(t){this.$$set({holdscale:t}),P()}get borderscale(){return this.$$.ctx[18]}set borderscale(t){this.$$set({borderscale:t}),P()}get iconsize(){return this.$$.ctx[19]}set iconsize(t){this.$$set({iconsize:t}),P()}get fxsize(){return this.$$.ctx[20]}set fxsize(t){this.$$set({fxsize:t}),P()}get customcssurl(){return this.$$.ctx[21]}set customcssurl(t){this.$$set({customcssurl:t}),P()}get customtypography(){return this.$$.ctx[37]}set customtypography(t){this.$$set({customtypography:t}),P()}}customElements.get("push-to-talk-button")?console.warn("Skipping re-defining customElement push-to-talk-button"):customElements.define("push-to-talk-button",$g)}));
//# sourceMappingURL=push-to-talk-button.js.map
